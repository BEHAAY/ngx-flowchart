{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ngx-flowchart/lib/ngx-flowchart.models.ts","ng://ngx-flowchart/lib/model.service.ts","ng://ngx-flowchart/lib/modelvalidation.service.ts","ng://ngx-flowchart/lib/node-dragging.service.ts","ng://ngx-flowchart/lib/edge-drawing.service.ts","ng://ngx-flowchart/lib/edge-dragging.service.ts","ng://ngx-flowchart/lib/mouseover.service.ts","ng://ngx-flowchart/lib/scrollparent.ts","ng://ngx-flowchart/lib/rectangleselect.service.ts","ng://ngx-flowchart/lib/ngx-flowchart.component.ts","ng://ngx-flowchart/lib/magnet.directive.ts","ng://ngx-flowchart/lib/connector.directive.ts","ng://ngx-flowchart/lib/node.component.ts","ng://ngx-flowchart/lib/default-node.component.ts","ng://ngx-flowchart/lib/ngx-flowchart.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__values","o","m","Symbol","iterator","i","call","next","length","value","done","FC_NODE_COMPONENT_CONFIG","InjectionToken","FlowchartConstants","htmlPrefix","leftConnectorType","rightConnectorType","curvedStyle","lineStyle","dragAnimationRepaint","dragAnimationShadow","canvasClass","selectedClass","editClass","activeClass","hoverClass","draggingClass","edgeClass","edgeLabelClass","connectorClass","magnetClass","nodeClass","nodeOverlayClass","leftConnectorClass","rightConnectorClass","canvasResizeThreshold","canvasResizeStep","ModelvalidationError","_super","message","tslib_1.__extends","Error","fcTopSort","graph","adjacentList","nodes","forEach","node","id","incoming","outgoing","edges","edge","sourceNode","filter","connectors","some","connector","source","destinationNode","destination","push","orderedNodes","sourceNodes","_c","tslib_1.__values","keys","_d","pop","splice","hasEdges","_e","_f","FcModelService","modelValidation","model","cd","selectedObjects","dropNode","createEdge","edgeAddedCallback","nodeRemovedCallback","edgeRemovedCallback","canvasHtmlElement","svgHtmlElement","connectorsHtmlElements","nodesHtmlElements","dragImage","validateModel","of","label","ConnectorsModel","NodesModel","EdgesModel","detectChanges","_this","setTimeout","selectObject","object","isEditable","indexOf","deselectObject","index","toggleSelectedObject","isSelectedObject","selectAll","readonly","select","deselectAll","isEditObject","inRectBox","x","y","rectBox","left","right","top","bottom","getItemInfoAtPoint","getNodeAtPoint","getEdgeAtPoint","_b","nodeElementBox","getHtmlElement","getBoundingClientRect","document","elementFromPoint","edgeIndex","startsWith","Number","substring","selectAllInRect","width","height","isSelected","deselect","canvasElementBox","start","sourceCoord","end","destCoord","deleteSelected","getSelectedEdges","delete","getSelectedNodes","undefined","dropTargetId","isDropSource","getDragImage","Image","src","style","visibility","registerCallbacks","AbstractFcModel","modelService","toggleSelected","isEdit","getConnector","connectorId","e_3","setHtmlElement","element","_getCoords","centered","canvas","connectorElementBox","coords","Math","round","offsetWidth","offsetHeight","getCoords","getCenteredCoord","getConnectorsByType","type","_addConnector","validateNode","error","connectorIds","getConnectorIds","handleClicked","ctrlKey","_addNode","validateNodes","map","getNodeByConnectorId","nodeId","ready","handleEdgeMouseClick","putEdge","_addEdge","event","sourceConnector","destConnector","validateConnector","validateEdges","concat","subscribe","created","FcModelValidationService","_validateEdges","ids","name","isArray","_validateEdge","edge1","index1","edge2","index2","validateEdge","Injectable","nodeDropScope","dropElement","FcNodeDraggingService","applyFunction","automaticResize","dragAnimation","nodeDraggingScope","shadowDragStarted","draggedNodes","shadowElements","dragOffsets","draggedElements","destinationHtmlElements","oldDisplayStyles","getCoordinate","coordinate","max","min","getXCoordinate","getYCoordinate","resizeCanvas","draggedNode","nodeElement","canvasElement","isDraggingNode","includes","dragstart","elements","selectedNodes","selectedNodes_1","selectedNodes_1_1","selectedNode","$","offsetsX","offsetsY","elements_1","elements_1_1","parseInt","css","clientX","clientY","originalEvent","parentNode","removeChild","cloneNode","offset","offsetInfo","offsetX","offsetY","position","pointerEvents","zIndex","body","appendChild","dropNodeInfo","dataTransfer","setData","JSON","stringify","setDragImage","target","display","dragOffset","shadowElement","targetInnerNode","children","backgroundColor","drop","preventDefault","infoText","getData","parse","e","dragover","dragend","replace","FcEdgeDrawingService","getEdgeDAttribute","pt1","pt2","dAddribute","sourceTangent","computeEdgeSourceTangent","destinationTangent","computeEdgeDestinationTangent","getEdgeCenter","computeEdgeTangentOffset","FcEdgeDraggingService","edgeDrawingService","isValidEdgeCallback","edgeStyle","edgeDragging","isDragging","dragPoint1","dragPoint2","draggedEdgeSource","destinationHtmlElement","oldDisplayStyle","swapConnector","dragLabel","prevEdge","this_1","gElement","querySelectorAll","pathElement","find","circleElement","attr","stopPropagation","magnetActive","dragoverConnector","dragleaveMagnet","dragoverMagnet","edge_1","targetConnector","FcMouseOverService","mouseoverscope","nodeMouseOver","nodeMouseOut","connectorMouseEnter","connectorMouseLeave","edgeMouseEnter","edgeMouseLeave","regex","prop","getComputedStyle","getPropertyValue","scroll","test","scrollparent","FcRectangleSelectService","selectElement","selectRect","x1","x2","y1","y2","$canvasElement","$scrollParent","mousedown","metaKey","button","hidden","pageX","pageY","updateSelectRect","mousemove","updateScroll","rect","topScroll","scroll_1","scrollTop","bottomScroll","scroll_2","leftScroll","scroll_3","scrollLeft","rightScroll","scroll_4","mouseup","selectObjects","x3","x4","y3","y4","NgxFlowchartComponent","elementRef","differs","zone","flowchartConstants","nodesDiffer","item","edgesDiffer","arrowDefId","random","arrowDefIdSelected","defineProperty","ngOnInit","nodeHeight","nodeWidth","userCallbacks","key","userNodeCallbacks","nodeCallbacks","nativeElement","edgeAdded","nodeRemoved","edgeRemoved","querySelector","run","bind","nodeDraggingService","edgeDraggingService","isValidEdge","mouseoverService","rectangleSelectService","callbacks","nodeDragstart","nodeDragend","edgeDragstart","edgeDragend","edgeDrop","edgeDragoverConnector","edgeDragoverMagnet","edgeDragleaveMagnet","nodeClicked","adjustCanvasSize","ngDoCheck","nodesChange","diff","edgesChange","nodesChanged_1","edgesChanged_1","forEachAddedItem","forEachRemovedItem","fit","maxX","maxY","canvasClick","edgeMouseDown","edgeClick","edgeRemove","edgeEdit","edgeDoubleClick","edgeMouseOver","Component","args","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","IterableDiffers","ChangeDetectorRef","NgZone","HostBinding","Input","HostListener","FcMagnetDirective","addClass","dragleave","Directive","FcConnectorDirective","modelservice","updateConnectorClass","ngOnChanges","changes","updateConnector","propName","change","firstChange","currentValue","previousValue","mouseOverConnector","removeClass","mouseenter","mouseleave","FcNodeContainerComponent","nodeComponentConfig","componentFactoryResolver","nodeEdit","doubleClick","mouseDown","mouseEnter","mouseLeave","updateNodeClass","nodeContentContainer","clear","componentFactory","resolveComponentFactory","nodeComponentType","componentRef","createComponent","nodeComponent","instance","updateNodeComponent","updateNode","toggleClass","selected","edit","underMouse","dragging","clazz","set","click","mouseover","mouseout","Inject","ComponentFactoryResolver","ViewChild","read","ViewContainerRef","static","FcNodeComponent","DefaultFcNodeComponent","Éµ0$1","NgxFlowchartModule","NgModule","entryComponents","declarations","providers","provide","useValue","imports","CommonModule","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Observable } from 'rxjs';\nimport { InjectionToken, Type } from '@angular/core';\nimport { FcNodeComponent } from './node.component';\n\nexport const FC_NODE_COMPONENT_CONFIG = new InjectionToken<FcNodeComponentConfig>('fc-node.component.config');\n\nexport interface FcNodeComponentConfig {\n  nodeComponentType: Type<FcNodeComponent>;\n}\n\nconst htmlPrefix = 'fc';\nconst leftConnectorType = 'leftConnector';\nconst rightConnectorType = 'rightConnector';\n\nexport const FlowchartConstants = {\n  htmlPrefix,\n  leftConnectorType,\n  rightConnectorType,\n  curvedStyle: 'curved',\n  lineStyle: 'line',\n  dragAnimationRepaint: 'repaint',\n  dragAnimationShadow: 'shadow',\n  canvasClass: htmlPrefix + '-canvas',\n  selectedClass: htmlPrefix + '-selected',\n  editClass: htmlPrefix + '-edit',\n  activeClass: htmlPrefix + '-active',\n  hoverClass: htmlPrefix + '-hover',\n  draggingClass: htmlPrefix + '-dragging',\n  edgeClass: htmlPrefix + '-edge',\n  edgeLabelClass: htmlPrefix + '-edge-label',\n  connectorClass: htmlPrefix + '-connector',\n  magnetClass: htmlPrefix + '-magnet',\n  nodeClass: htmlPrefix + '-node',\n  nodeOverlayClass: htmlPrefix + '-node-overlay',\n  leftConnectorClass: htmlPrefix + '-' + leftConnectorType + 's',\n  rightConnectorClass: htmlPrefix + '-' + rightConnectorType + 's',\n  canvasResizeThreshold: 200,\n  canvasResizeStep: 200\n};\n\n\nexport interface FcCoords {\n  x?: number;\n  y?: number;\n}\n\nexport interface FcOffset {\n  top: number;\n  left: number;\n}\n\nexport interface FcRectBox {\n  top: number;\n  left: number;\n  right: number;\n  bottom: number;\n}\n\nexport interface FcConnector {\n  id: string;\n  type: string;\n}\n\nexport interface FcNode extends FcCoords {\n  id: string;\n  name: string;\n  connectors: Array<FcConnector>;\n  readonly?: boolean;\n  [key: string]: any;\n}\n\nexport interface FcEdge {\n  label?: string;\n  source?: string;\n  destination?: string;\n  active?: boolean;\n}\n\nexport interface FcItemInfo {\n  node?: FcNode;\n  edge?: FcEdge;\n}\n\nexport interface FcModel {\n  nodes: Array<FcNode>;\n  edges: Array<FcEdge>;\n}\n\nexport interface UserCallbacks {\n  dropNode?: (event: Event, node: FcNode) => void;\n  createEdge?: (event: Event, edge: FcEdge) => Observable<FcEdge>;\n  edgeAdded?: (edge: FcEdge) => void;\n  nodeRemoved?: (node: FcNode) => void;\n  edgeRemoved?: (edge: FcEdge) => void;\n  edgeDoubleClick?: (event: MouseEvent, edge: FcEdge) => void;\n  edgeMouseOver?: (event: MouseEvent, edge: FcEdge) => void;\n  isValidEdge?: (source: FcConnector, destination: FcConnector) => boolean;\n  edgeEdit?: (event: Event, edge: FcEdge) => void;\n  nodeCallbacks?: UserNodeCallbacks;\n}\n\nexport interface UserNodeCallbacks {\n  nodeEdit?: (event: MouseEvent, node: FcNode) => void;\n  doubleClick?: (event: MouseEvent, node: FcNode) => void;\n  mouseDown?: (event: MouseEvent, node: FcNode) => void;\n  mouseEnter?: (event: MouseEvent, node: FcNode) => void;\n  mouseLeave?: (event: MouseEvent, node: FcNode) => void;\n}\n\nexport interface FcCallbacks {\n  nodeDragstart: (event: DragEvent, node: FcNode) => void;\n  nodeDragend: (event: DragEvent) => void;\n  edgeDragstart: (event: DragEvent, connector: FcConnector) => void;\n  edgeDragend: (event: DragEvent) => void;\n  edgeDrop: (event: DragEvent, targetConnector: FcConnector) => boolean;\n  edgeDragoverConnector: (event: DragEvent, connector: FcConnector) => boolean;\n  edgeDragoverMagnet: (event: DragEvent, connector: FcConnector) => boolean;\n  edgeDragleaveMagnet: (event: DragEvent) => void;\n  nodeMouseOver: (event: MouseEvent, node: FcNode) => void;\n  nodeMouseOut: (event: MouseEvent, node: FcNode) => void;\n  connectorMouseEnter: (event: MouseEvent, connector: FcConnector) => void;\n  connectorMouseLeave: (event: MouseEvent, connector: FcConnector) => void;\n  nodeClicked: (event: MouseEvent, node: FcNode) => void;\n}\n\nexport interface FcAdjacentList {\n  [id: string]: {\n    incoming: number;\n    outgoing: Array<string>;\n  };\n}\n\nexport class ModelvalidationError extends Error {\n  constructor(message: string) {\n    super(message);\n  }\n}\n\nexport function fcTopSort(graph: FcModel): Array<string> | null {\n  const adjacentList: FcAdjacentList = {};\n  graph.nodes.forEach((node) => {\n    adjacentList[node.id] = {incoming: 0, outgoing: []};\n  });\n  graph.edges.forEach((edge) => {\n    const sourceNode = graph.nodes.filter((node) => {\n      return node.connectors.some((connector) => {\n        return connector.id === edge.source;\n      });\n    })[0];\n    const destinationNode = graph.nodes.filter((node) => {\n      return node.connectors.some((connector) => {\n        return connector.id === edge.destination;\n      });\n    })[0];\n    adjacentList[sourceNode.id].outgoing.push(destinationNode.id);\n    adjacentList[destinationNode.id].incoming++;\n  });\n  const orderedNodes: string[] = [];\n  const sourceNodes: string[] = [];\n  for (const node of Object.keys(adjacentList)) {\n    const edges = adjacentList[node];\n    if (edges.incoming === 0) {\n      sourceNodes.push(node);\n    }\n  }\n  while (sourceNodes.length !== 0) {\n    const sourceNode = sourceNodes.pop();\n    for (let i = 0; i < adjacentList[sourceNode].outgoing.length; i++) {\n      const destinationNode = adjacentList[sourceNode].outgoing[i];\n      adjacentList[destinationNode].incoming--;\n      if (adjacentList[destinationNode].incoming === 0) {\n        sourceNodes.push(destinationNode);\n      }\n      adjacentList[sourceNode].outgoing.splice(i, 1);\n      i--;\n    }\n    orderedNodes.push(sourceNode);\n  }\n  let hasEdges = false;\n  for (const node of Object.keys(adjacentList)) {\n    const edges = adjacentList[node];\n    if (edges.incoming !== 0) {\n      hasEdges = true;\n    }\n  }\n  if (hasEdges) {\n    return null;\n  } else {\n    return orderedNodes;\n  }\n}\n","import { FcModelValidationService } from './modelvalidation.service';\nimport { FcConnector, FcCoords, FcEdge, FcItemInfo, FcModel, FcNode, FcRectBox } from './ngx-flowchart.models';\nimport { Observable, of } from 'rxjs';\nimport { ChangeDetectorRef } from '@angular/core';\n\nexport class FcModelService {\n\n  modelValidation: FcModelValidationService;\n  model: FcModel;\n  cd: ChangeDetectorRef;\n  selectedObjects: any[];\n\n  connectorsHtmlElements: HtmlElementMap = {};\n  nodesHtmlElements: HtmlElementMap = {};\n  canvasHtmlElement: HTMLElement = null;\n  dragImage: HTMLImageElement = null;\n  svgHtmlElement: SVGElement = null;\n\n  dropNode: (event: Event, node: FcNode) => void;\n  createEdge: (event: Event, edge: FcEdge) => Observable<FcEdge>;\n  edgeAddedCallback: (edge: FcEdge) => void;\n  nodeRemovedCallback: (node: FcNode) => void;\n  edgeRemovedCallback: (edge: FcEdge) => void;\n\n  dropTargetId: string;\n\n  connectors: ConnectorsModel;\n  nodes: NodesModel;\n  edges: EdgesModel;\n\n  constructor(modelValidation: FcModelValidationService,\n              model: FcModel,\n              cd: ChangeDetectorRef,\n              selectedObjects: any[],\n              dropNode: (event: Event, node: FcNode) => void,\n              createEdge: (event: Event, edge: FcEdge) => Observable<FcEdge>,\n              edgeAddedCallback: (edge: FcEdge) => void,\n              nodeRemovedCallback: (node: FcNode) => void,\n              edgeRemovedCallback: (edge: FcEdge) => void,\n              canvasHtmlElement: HTMLElement,\n              svgHtmlElement: SVGElement) {\n\n    this.modelValidation = modelValidation;\n    this.model = model;\n    this.cd = cd;\n    this.canvasHtmlElement = canvasHtmlElement;\n    this.svgHtmlElement = svgHtmlElement;\n    this.modelValidation.validateModel(this.model);\n    this.selectedObjects = selectedObjects;\n\n    this.dropNode = dropNode || (() => {});\n    this.createEdge = createEdge || (() => of({label: 'label'}));\n    this.edgeAddedCallback = edgeAddedCallback || (() => {});\n    this.nodeRemovedCallback = nodeRemovedCallback || (() => {});\n    this.edgeRemovedCallback = edgeRemovedCallback || (() => {});\n\n    this.connectors = new ConnectorsModel(this);\n    this.nodes = new NodesModel(this);\n    this.edges = new EdgesModel(this);\n  }\n\n  public detectChanges() {\n    setTimeout(() => {\n      this.cd.detectChanges();\n    }, 0);\n  }\n\n  public selectObject(object: any) {\n    if (this.isEditable()) {\n      if (this.selectedObjects.indexOf(object) === -1) {\n        this.selectedObjects.push(object);\n      }\n    }\n  }\n\n  public deselectObject(object: any) {\n    if (this.isEditable()) {\n      const index = this.selectedObjects.indexOf(object);\n      if (index === -1) {\n        throw new Error('Tried to deselect an unselected object');\n      }\n      this.selectedObjects.splice(index, 1);\n    }\n  }\n\n  public toggleSelectedObject(object: any) {\n    if (this.isSelectedObject(object)) {\n      this.deselectObject(object);\n    } else {\n      this.selectObject(object);\n    }\n  }\n\n  public isSelectedObject(object: any): boolean {\n    return this.selectedObjects.indexOf(object) !== -1;\n  }\n\n  public selectAll() {\n    this.model.nodes.forEach(node => {\n      if (!node.readonly) {\n        this.nodes.select(node);\n      }\n    });\n    this.model.edges.forEach(edge => {\n      this.edges.select(edge);\n    });\n    this.detectChanges();\n  }\n\n  public deselectAll() {\n    this.selectedObjects.splice(0, this.selectedObjects.length);\n    this.detectChanges();\n  }\n\n  public isEditObject(object: any): boolean {\n    return this.selectedObjects.length === 1 &&\n      this.selectedObjects.indexOf(object) !== -1;\n  }\n\n  private inRectBox(x: number, y: number, rectBox: FcRectBox): boolean {\n    return x >= rectBox.left && x <= rectBox.right &&\n      y >= rectBox.top && y <= rectBox.bottom;\n  }\n\n  public getItemInfoAtPoint(x: number, y: number): FcItemInfo {\n    return {\n      node: this.getNodeAtPoint(x, y),\n      edge: this.getEdgeAtPoint(x, y)\n    };\n  }\n\n  public getNodeAtPoint(x: number, y: number): FcNode {\n    for (const node of this.model.nodes) {\n      const element = this.nodes.getHtmlElement(node.id);\n      const nodeElementBox = element.getBoundingClientRect();\n      if (x >= nodeElementBox.left && x <= nodeElementBox.right\n        && y >= nodeElementBox.top && y <= nodeElementBox.bottom) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  public getEdgeAtPoint(x: number, y: number): FcEdge {\n    const element = document.elementFromPoint(x, y);\n    const id = element.id;\n    let edgeIndex = -1;\n    if (id) {\n      if (id.startsWith('fc-edge-path-')) {\n        edgeIndex = Number(id.substring('fc-edge-path-'.length));\n      } else if (id.startsWith('fc-edge-label-')) {\n        edgeIndex = Number(id.substring('fc-edge-label-'.length));\n      }\n    }\n    if (edgeIndex > -1) {\n      return this.model.edges[edgeIndex];\n    }\n    return null;\n  }\n\n  public selectAllInRect(rectBox: FcRectBox) {\n    this.model.nodes.forEach((value) => {\n      const element = this.nodes.getHtmlElement(value.id);\n      const nodeElementBox = element.getBoundingClientRect();\n      if (!value.readonly) {\n        const x = nodeElementBox.left + nodeElementBox.width / 2;\n        const y = nodeElementBox.top + nodeElementBox.height / 2;\n        if (this.inRectBox(x, y, rectBox)) {\n          this.nodes.select(value);\n        } else {\n          if (this.nodes.isSelected(value)) {\n            this.nodes.deselect(value);\n          }\n        }\n      }\n    });\n    const canvasElementBox = this.canvasHtmlElement.getBoundingClientRect();\n    this.model.edges.forEach((value) => {\n      const start = this.edges.sourceCoord(value);\n      const end = this.edges.destCoord(value);\n      const x = (start.x + end.x) / 2 + canvasElementBox.left;\n      const y = (start.y + end.y) / 2 + canvasElementBox.top;\n      if (this.inRectBox(x, y, rectBox)) {\n        this.edges.select(value);\n      } else {\n        if (this.edges.isSelected(value)) {\n          this.edges.deselect(value);\n        }\n      }\n    });\n  }\n\n  public deleteSelected() {\n    const edgesToDelete = this.edges.getSelectedEdges();\n    edgesToDelete.forEach((edge) => {\n      this.edges.delete(edge);\n    });\n    const nodesToDelete = this.nodes.getSelectedNodes();\n    nodesToDelete.forEach((node) => {\n      this.nodes.delete(node);\n    });\n  }\n\n  public isEditable(): boolean {\n    return this.dropTargetId === undefined;\n  }\n\n  public isDropSource(): boolean {\n    return this.dropTargetId !== undefined;\n  }\n\n  public getDragImage(): HTMLImageElement {\n    if (!this.dragImage) {\n      this.dragImage = new Image();\n      this.dragImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n      this.dragImage.style.visibility = 'hidden';\n    }\n    return this.dragImage;\n  }\n\n  public registerCallbacks(edgeAddedCallback: (edge: FcEdge) => void,\n                           nodeRemovedCallback: (node: FcNode) => void,\n                           edgeRemovedCallback: (edge: FcEdge) => void) {\n    this.edgeAddedCallback = edgeAddedCallback;\n    this.nodeRemovedCallback = nodeRemovedCallback;\n    this.edgeRemovedCallback = edgeRemovedCallback;\n  }\n\n}\n\ninterface HtmlElementMap { [id: string]: HTMLElement; }\n\nabstract class AbstractFcModel<T> {\n\n  modelService: FcModelService;\n\n  protected constructor(modelService: FcModelService) {\n    this.modelService = modelService;\n  }\n\n  public select(object: T) {\n    this.modelService.selectObject(object);\n  }\n\n  public deselect(object: T) {\n    this.modelService.deselectObject(object);\n  }\n\n  public toggleSelected(object: T) {\n    this.modelService.toggleSelectedObject(object);\n  }\n\n  public isSelected(object: T): boolean {\n    return this.modelService.isSelectedObject(object);\n  }\n\n  public isEdit(object: T): boolean {\n    return this.modelService.isEditObject(object);\n  }\n}\n\nclass ConnectorsModel extends AbstractFcModel<FcConnector> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public getConnector(connectorId: string): FcConnector {\n    const model = this.modelService.model;\n    for (const node of model.nodes) {\n      for (const connector of node.connectors) {\n        if (connector.id === connectorId) {\n          return connector;\n        }\n      }\n    }\n  }\n\n  public getHtmlElement(connectorId: string): HTMLElement {\n    return this.modelService.connectorsHtmlElements[connectorId];\n  }\n\n  public setHtmlElement(connectorId: string, element: HTMLElement) {\n    this.modelService.connectorsHtmlElements[connectorId] = element;\n    this.modelService.detectChanges();\n  }\n\n  private _getCoords(connectorId: string, centered?: boolean): FcCoords {\n    const element = this.getHtmlElement(connectorId);\n    const canvas = this.modelService.canvasHtmlElement;\n    if (element === null || element === undefined || canvas === null) {\n      return {x: 0, y: 0};\n    }\n    const connectorElementBox = element.getBoundingClientRect();\n    const canvasElementBox = canvas.getBoundingClientRect();\n    let coords: FcCoords = {\n      x: connectorElementBox.left - canvasElementBox.left,\n      y: connectorElementBox.top - canvasElementBox.top\n    };\n    if (centered) {\n      coords = {\n        x: Math.round(coords.x + element.offsetWidth / 2),\n        y: Math.round(coords.y + element.offsetHeight / 2)\n      };\n    }\n    return coords;\n  }\n\n  public getCoords(connectorId: string): FcCoords {\n    return this._getCoords(connectorId, false);\n  }\n\n  public getCenteredCoord(connectorId: string): FcCoords {\n    return this._getCoords(connectorId, true);\n  }\n}\n\nclass NodesModel extends AbstractFcModel<FcNode> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public getConnectorsByType(node: FcNode, type: string): Array<FcConnector> {\n    return node.connectors.filter((connector) => {\n      return connector.type === type;\n    });\n  }\n\n  private _addConnector(node: FcNode, connector: FcConnector) {\n    node.connectors.push(connector);\n    try {\n      this.modelService.modelValidation.validateNode(node);\n    } catch (error) {\n      node.connectors.splice(node.connectors.indexOf(connector), 1);\n      throw error;\n    }\n  }\n\n  public delete(node: FcNode) {\n    if (this.isSelected(node)) {\n      this.deselect(node);\n    }\n    const model = this.modelService.model;\n    const index = model.nodes.indexOf(node);\n    if (index === -1) {\n      if (node === undefined) {\n        throw new Error('Passed undefined');\n      }\n      throw new Error('Tried to delete not existing node');\n    }\n    const connectorIds = this.getConnectorIds(node);\n    for (let i = 0; i < model.edges.length; i++) {\n      const edge = model.edges[i];\n      if (connectorIds.indexOf(edge.source) !== -1 || connectorIds.indexOf(edge.destination) !== -1) {\n        this.modelService.edges.delete(edge);\n        i--;\n      }\n    }\n    model.nodes.splice(index, 1);\n    this.modelService.nodeRemovedCallback(node);\n  }\n\n  public getSelectedNodes(): Array<FcNode> {\n    const model = this.modelService.model;\n    return model.nodes.filter((node) => {\n      return this.modelService.nodes.isSelected(node);\n    });\n  }\n\n  public handleClicked(node: FcNode, ctrlKey?: boolean) {\n    if (ctrlKey) {\n      this.modelService.nodes.toggleSelected(node);\n    } else {\n      this.modelService.deselectAll();\n      this.modelService.nodes.select(node);\n    }\n  }\n\n  private _addNode(node: FcNode) {\n    const model = this.modelService.model;\n    try {\n      model.nodes.push(node);\n      this.modelService.modelValidation.validateNodes(model.nodes);\n    } catch (error) {\n      model.nodes.splice(model.nodes.indexOf(node), 1);\n      throw error;\n    }\n  }\n\n  public getConnectorIds(node: FcNode): Array<string> {\n    return node.connectors.map((connector) => {\n      return connector.id;\n    });\n  }\n\n  public getNodeByConnectorId(connectorId: string): FcNode {\n    const model = this.modelService.model;\n    for (const node of model.nodes) {\n      const connectorIds = this.getConnectorIds(node);\n      if (connectorIds.indexOf(connectorId) > -1) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  public getHtmlElement(nodeId: string): HTMLElement {\n    return this.modelService.nodesHtmlElements[nodeId];\n  }\n\n  public setHtmlElement(nodeId: string, element: HTMLElement) {\n    this.modelService.nodesHtmlElements[nodeId] = element;\n    this.modelService.detectChanges();\n  }\n\n}\n\nclass EdgesModel extends AbstractFcModel<FcEdge> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public ready(edge: FcEdge): boolean {\n    const source = this.modelService.connectors.getHtmlElement(edge.source);\n    const destination = this.modelService.connectors.getHtmlElement(edge.destination);\n    return source !== undefined && destination !== undefined;\n  }\n\n  public sourceCoord(edge: FcEdge): FcCoords {\n    return this.modelService.connectors.getCenteredCoord(edge.source);\n  }\n\n  public destCoord(edge: FcEdge): FcCoords {\n    return this.modelService.connectors.getCenteredCoord(edge.destination);\n  }\n\n  public delete(edge: FcEdge) {\n    const model = this.modelService.model;\n    const index = model.edges.indexOf(edge);\n    if (index === -1) {\n      throw new Error('Tried to delete not existing edge');\n    }\n    if (this.isSelected(edge)) {\n      this.deselect(edge);\n    }\n    model.edges.splice(index, 1);\n    this.modelService.edgeRemovedCallback(edge);\n  }\n\n  public getSelectedEdges(): Array<FcEdge> {\n    const model = this.modelService.model;\n    return model.edges.filter((edge) => {\n      return this.modelService.edges.isSelected(edge);\n    });\n  }\n\n  public handleEdgeMouseClick(edge: FcEdge, ctrlKey?: boolean) {\n    if (ctrlKey) {\n      this.modelService.edges.toggleSelected(edge);\n    } else {\n      this.modelService.deselectAll();\n      this.modelService.edges.select(edge);\n    }\n  }\n\n  public putEdge(edge: FcEdge) {\n    const model = this.modelService.model;\n    model.edges.push(edge);\n  }\n\n  public _addEdge(event: Event, sourceConnector: FcConnector, destConnector: FcConnector, label: string) {\n    this.modelService.modelValidation.validateConnector(sourceConnector);\n    this.modelService.modelValidation.validateConnector(destConnector);\n    const edge: FcEdge = {};\n    edge.source = sourceConnector.id;\n    edge.destination = destConnector.id;\n    edge.label = label;\n    const model = this.modelService.model;\n    this.modelService.modelValidation.validateEdges(model.edges.concat([edge]), model.nodes);\n    this.modelService.createEdge(event, edge).subscribe(\n      (created) => {\n        model.edges.push(created);\n        this.modelService.edgeAddedCallback(created);\n      }\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { FcConnector, FcEdge, FcModel, FcNode, fcTopSort, ModelvalidationError } from './ngx-flowchart.models';\n\n@Injectable()\nexport class FcModelValidationService {\n\n  constructor() { }\n\n  public validateModel(model: FcModel): FcModel {\n    this.validateNodes(model.nodes);\n    this._validateEdges(model.edges, model.nodes);\n    return model;\n  }\n\n  public validateNodes(nodes: Array<FcNode>): Array<FcNode> {\n    const ids: string[] = [];\n    nodes.forEach((node) => {\n      this.validateNode(node);\n      if (ids.indexOf(node.id) !== -1) {\n        throw new ModelvalidationError('Id not unique.');\n      }\n      ids.push(node.id);\n    });\n    const connectorIds: string[] = [];\n    nodes.forEach((node) => {\n      node.connectors.forEach((connector) => {\n        if (connectorIds.indexOf(connector.id) !== -1) {\n          throw new ModelvalidationError('Id not unique.');\n        }\n        connectorIds.push(connector.id);\n      });\n    });\n    return nodes;\n  }\n\n  public validateNode(node: FcNode): FcNode {\n    if (node.id === undefined) {\n      throw new ModelvalidationError('Id not valid.');\n    }\n    if (typeof node.name !== 'string') {\n      throw new ModelvalidationError('Name not valid.');\n    }\n    if (typeof node.x !== 'number' || node.x < 0 || Math.round(node.x) !== node.x) {\n      throw new ModelvalidationError('Coordinates not valid.');\n    }\n    if (typeof node.y !== 'number' || node.y < 0 || Math.round(node.y) !== node.y) {\n      throw new ModelvalidationError('Coordinates not valid.');\n    }\n    if (!Array.isArray(node.connectors)) {\n      throw new ModelvalidationError('Connectors not valid.');\n    }\n    node.connectors.forEach((connector) => {\n      this.validateConnector(connector);\n    });\n    return node;\n  }\n\n  private _validateEdges(edges: Array<FcEdge>, nodes: Array<FcNode>): Array<FcEdge> {\n    edges.forEach((edge) => {\n      this._validateEdge(edge, nodes);\n    });\n    edges.forEach((edge1, index1) => {\n      edges.forEach((edge2, index2) => {\n        if (index1 !== index2) {\n          if ((edge1.source === edge2.source && edge1.destination === edge2.destination) ||\n            (edge1.source === edge2.destination && edge1.destination === edge2.source)) {\n            throw new ModelvalidationError('Duplicated edge.');\n          }\n        }\n      });\n    });\n    if (fcTopSort({nodes, edges}) === null) {\n      throw new ModelvalidationError('Graph has a circle.');\n    }\n    return edges;\n  }\n\n  public validateEdges(edges: Array<FcEdge>, nodes: Array<FcNode>): Array<FcEdge> {\n    this.validateNodes(nodes);\n    return this._validateEdges(edges, nodes);\n  }\n\n  private _validateEdge(edge: FcEdge, nodes: Array<FcNode>): FcEdge {\n    if (edge.source === undefined) {\n      throw new ModelvalidationError('Source not valid.');\n    }\n    if (edge.destination === undefined) {\n      throw new ModelvalidationError('Destination not valid.');\n    }\n    if (edge.source === edge.destination) {\n      throw new ModelvalidationError('Edge with same source and destination connectors.');\n    }\n    const sourceNode = nodes.filter((node) => node.connectors.some((connector) => connector.id === edge.source))[0];\n    if (sourceNode === undefined) {\n      throw new ModelvalidationError('Source not valid.');\n    }\n    const destinationNode = nodes.filter((node) => node.connectors.some((connector) => connector.id === edge.destination))[0];\n    if (destinationNode === undefined) {\n      throw new ModelvalidationError('Destination not valid.');\n    }\n    if (sourceNode === destinationNode) {\n      throw new ModelvalidationError('Edge with same source and destination nodes.');\n    }\n    return edge;\n  }\n\n  public validateEdge(edge: FcEdge, nodes: Array<FcNode>): FcEdge {\n    this.validateNodes(nodes);\n    return this._validateEdge(edge, nodes);\n  }\n\n  public validateConnector(connector: FcConnector): FcConnector {\n    if (connector.id === undefined) {\n      throw new ModelvalidationError('Id not valid.');\n    }\n    if (connector.type === undefined || connector.type === null || typeof connector.type !== 'string') {\n      throw new ModelvalidationError('Type not valid.');\n    }\n    return connector;\n  }\n\n}\n","import { FcModelService } from './model.service';\nimport { FcCoords, FcNode, FlowchartConstants } from './ngx-flowchart.models';\n\nconst nodeDropScope: NodeDropScope = {\n  dropElement: null\n};\n\nexport class FcNodeDraggingService {\n\n  nodeDraggingScope: NodeDraggingScope = {\n    shadowDragStarted: false,\n    dropElement: null,\n    draggedNodes: [],\n    shadowElements: []\n  };\n\n  private dragOffsets: FcCoords[] = [];\n  private draggedElements: HTMLElement[] = [];\n\n  private destinationHtmlElements: HTMLElement[] = [];\n  private oldDisplayStyles: string[] = [];\n\n  private readonly modelService: FcModelService;\n  private readonly automaticResize: boolean;\n  private readonly dragAnimation: string;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(modelService: FcModelService,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T,\n              automaticResize: boolean, dragAnimation: string) {\n    this.modelService = modelService;\n    this.automaticResize = automaticResize;\n    this.dragAnimation = dragAnimation;\n    this.applyFunction = applyFunction;\n  }\n\n  private getCoordinate(coordinate: number, max: number): number {\n    coordinate = Math.max(coordinate, 0);\n    coordinate = Math.min(coordinate, max);\n    return coordinate;\n  }\n\n  private getXCoordinate(x: number): number {\n    return this.getCoordinate(x, this.modelService.canvasHtmlElement.offsetWidth);\n  }\n\n  private getYCoordinate(y: number): number {\n    return this.getCoordinate(y, this.modelService.canvasHtmlElement.offsetHeight);\n  }\n\n  private resizeCanvas(draggedNode: FcNode, nodeElement: HTMLElement) {\n    if (this.automaticResize && !this.modelService.isDropSource()) {\n      const canvasElement = this.modelService.canvasHtmlElement;\n      if (canvasElement.offsetWidth < draggedNode.x + nodeElement.offsetWidth + FlowchartConstants.canvasResizeThreshold) {\n        canvasElement.style.width = canvasElement.offsetWidth + FlowchartConstants.canvasResizeStep + 'px';\n      }\n      if (canvasElement.offsetHeight < draggedNode.y + nodeElement.offsetHeight + FlowchartConstants.canvasResizeThreshold) {\n        canvasElement.style.height = canvasElement.offsetHeight + FlowchartConstants.canvasResizeStep + 'px';\n      }\n    }\n  }\n\n  public isDraggingNode(node: FcNode): boolean {\n    return this.nodeDraggingScope.draggedNodes.includes(node);\n  }\n\n  public dragstart(event: DragEvent, node: FcNode) {\n    if (node.readonly) {\n      return;\n    }\n    this.dragOffsets.length = 0;\n    this.draggedElements.length = 0;\n    this.nodeDraggingScope.draggedNodes.length = 0;\n    this.nodeDraggingScope.shadowElements.length = 0;\n    this.destinationHtmlElements.length = 0;\n    this.oldDisplayStyles.length = 0;\n    const elements: Array<JQuery<HTMLElement>> = [];\n    const nodes: Array<FcNode> = [];\n    if (this.modelService.nodes.isSelected(node)) {\n      const selectedNodes = this.modelService.nodes.getSelectedNodes();\n      for (const selectedNode of selectedNodes) {\n        const element = $(this.modelService.nodes.getHtmlElement(selectedNode.id));\n        elements.push(element);\n        nodes.push(selectedNode);\n      }\n    } else {\n      elements.push($(event.target as HTMLElement));\n      nodes.push(node);\n    }\n    const offsetsX: number[] = [];\n    const offsetsY: number[] = [];\n    for (const element of elements) {\n      offsetsX.push(parseInt(element.css('left'), 10) - event.clientX);\n      offsetsY.push(parseInt(element.css('top'), 10) - event.clientY);\n    }\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n    if (this.modelService.isDropSource()) {\n      if (nodeDropScope.dropElement) {\n        nodeDropScope.dropElement.parentNode.removeChild(nodeDropScope.dropElement);\n        nodeDropScope.dropElement = null;\n      }\n      nodeDropScope.dropElement = elements[0][0].cloneNode(true) as NodeDropElement;\n      const offset = $(this.modelService.canvasHtmlElement).offset();\n      nodeDropScope.dropElement.offsetInfo = {\n        offsetX: Math.round(offsetsX[0] + offset.left),\n        offsetY: Math.round(offsetsY[0] + offset.top)\n      };\n      nodeDropScope.dropElement.style.position = 'absolute';\n      nodeDropScope.dropElement.style.pointerEvents = 'none';\n      nodeDropScope.dropElement.style.zIndex = '9999';\n\n      document.body.appendChild(nodeDropScope.dropElement);\n      const dropNodeInfo: DropNodeInfo = {\n        node,\n        dropTargetId: this.modelService.dropTargetId,\n        offsetX: Math.round(offsetsX[0] + offset.left),\n        offsetY: Math.round(offsetsY[0] + offset.top)\n      };\n      originalEvent.dataTransfer.setData('text', JSON.stringify(dropNodeInfo));\n\n      if (originalEvent.dataTransfer.setDragImage) {\n        originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n      } else {\n        const target: HTMLElement = event.target as HTMLElement;\n        this.destinationHtmlElements.push(target);\n        this.oldDisplayStyles.push(target.style.display);\n        target.style.display = 'none';\n        this.nodeDraggingScope.shadowDragStarted = true;\n      }\n      return;\n    }\n    this.nodeDraggingScope.draggedNodes = nodes;\n    for (let i = 0; i < elements.length; i++) {\n      this.draggedElements.push(elements[i][0]);\n      this.dragOffsets.push(\n        {\n          x: offsetsX[i],\n          y: offsetsY[i]\n        }\n      );\n    }\n\n    if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      for (let i = 0; i < this.draggedElements.length; i++) {\n        const dragOffset = this.dragOffsets[i];\n        const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n        const shadowElement = $(`<div style=\"position: absolute; opacity: 0.7; ` +\n                                `top: ${this.getYCoordinate(dragOffset.y + event.clientY)}px; ` +\n                                `left: ${this.getXCoordinate(dragOffset.x + event.clientX)}px; \">` +\n                                `<div class=\"innerNode\"><p style=\"padding: 0 15px;\">${draggedNode.name}</p> </div></div>`);\n        const targetInnerNode = $(this.draggedElements[i]).children()[0];\n        shadowElement.children()[0].style.backgroundColor = targetInnerNode.style.backgroundColor;\n        this.nodeDraggingScope.shadowElements.push(shadowElement);\n        this.modelService.canvasHtmlElement.appendChild(this.nodeDraggingScope.shadowElements[i][0]);\n      }\n    }\n    originalEvent.dataTransfer.setData('text', 'Just to support firefox');\n    if (originalEvent.dataTransfer.setDragImage) {\n      originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n    } else {\n      for (let i = 0; i < this.draggedElements.length; i++) {\n        this.destinationHtmlElements.push(this.draggedElements[i]);\n        this.oldDisplayStyles.push(this.destinationHtmlElements[i].style.display);\n        this.destinationHtmlElements[i].style.display = 'none';\n      }\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        this.nodeDraggingScope.shadowDragStarted = true;\n      }\n    }\n  }\n\n  public drop(event: DragEvent): boolean {\n    if (this.modelService.isDropSource()) {\n      event.preventDefault();\n      return false;\n    }\n    let dropNode: FcNode = null;\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n    const infoText = originalEvent.dataTransfer.getData('text');\n    if (infoText) {\n      let dropNodeInfo: DropNodeInfo = null;\n      try {\n        dropNodeInfo = JSON.parse(infoText);\n      } catch (e) {}\n      if (dropNodeInfo && dropNodeInfo.dropTargetId) {\n        if (this.modelService.canvasHtmlElement.id &&\n          this.modelService.canvasHtmlElement.id === dropNodeInfo.dropTargetId) {\n          dropNode = dropNodeInfo.node;\n          const offset = $(this.modelService.canvasHtmlElement).offset();\n          const x = event.clientX - offset.left;\n          const y = event.clientY - offset.top;\n          dropNode.x = Math.round(this.getXCoordinate(dropNodeInfo.offsetX + x));\n          dropNode.y = Math.round(this.getYCoordinate(dropNodeInfo.offsetY + y));\n        }\n      }\n    }\n    if (dropNode) {\n      this.modelService.dropNode(event, dropNode);\n      event.preventDefault();\n      return false;\n    } else if (this.nodeDraggingScope.draggedNodes.length) {\n      return this.applyFunction(() => {\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const dragOffset = this.dragOffsets[i];\n          draggedNode.x = Math.round(this.getXCoordinate(dragOffset.x + event.clientX));\n          draggedNode.y = Math.round(this.getYCoordinate(dragOffset.y + event.clientY));\n        }\n        event.preventDefault();\n        return false;\n      });\n    }\n  }\n\n  public dragover(event: DragEvent) {\n    if (nodeDropScope.dropElement) {\n      const offsetInfo = nodeDropScope.dropElement.offsetInfo;\n      nodeDropScope.dropElement.style.left = (offsetInfo.offsetX + event.clientX) + 'px';\n      nodeDropScope.dropElement.style.top = (offsetInfo.offsetY + event.clientY) + 'px';\n      if (this.nodeDraggingScope.shadowDragStarted) {\n        this.applyFunction(() => {\n          this.destinationHtmlElements[0].style.display = this.oldDisplayStyles[0];\n          this.nodeDraggingScope.shadowDragStarted = false;\n        });\n      }\n      event.preventDefault();\n      return;\n    }\n    if (this.modelService.isDropSource()) {\n      event.preventDefault();\n      return;\n    }\n    if (!this.nodeDraggingScope.draggedNodes.length) {\n      event.preventDefault();\n      return;\n    }\n    if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        return this.applyFunction(() => {\n          for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n            const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n            const dragOffset = this.dragOffsets[i];\n            draggedNode.x = this.getXCoordinate(dragOffset.x + event.clientX);\n            draggedNode.y = this.getYCoordinate(dragOffset.y + event.clientY);\n            this.resizeCanvas(draggedNode, this.draggedElements[i]);\n          }\n          event.preventDefault();\n          return false;\n        });\n      }\n    } else if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        if (this.nodeDraggingScope.shadowDragStarted) {\n          this.applyFunction(() => {\n            for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n              this.destinationHtmlElements[i].style.display = this.oldDisplayStyles[i];\n            }\n            this.nodeDraggingScope.shadowDragStarted = false;\n          });\n        }\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const dragOffset = this.dragOffsets[i];\n          this.nodeDraggingScope.shadowElements[i].css('left', this.getXCoordinate(dragOffset.x + event.clientX) + 'px');\n          this.nodeDraggingScope.shadowElements[i].css('top', this.getYCoordinate(dragOffset.y + event.clientY) + 'px');\n          this.resizeCanvas(draggedNode, this.draggedElements[i]);\n        }\n        event.preventDefault();\n      }\n    }\n  }\n\n  public dragend(event: DragEvent) {\n    this.applyFunction(() => {\n      if (nodeDropScope.dropElement) {\n        nodeDropScope.dropElement.parentNode.removeChild(nodeDropScope.dropElement);\n        nodeDropScope.dropElement = null;\n      }\n      if (this.modelService.isDropSource()) {\n        return;\n      }\n      if (this.nodeDraggingScope.shadowElements.length) {\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const shadowElement = this.nodeDraggingScope.shadowElements[i];\n          draggedNode.x = parseInt(shadowElement.css('left').replace('px', ''), 10);\n          draggedNode.y = parseInt(shadowElement.css('top').replace('px', ''), 10);\n          this.modelService.canvasHtmlElement.removeChild(shadowElement[0]);\n        }\n        this.nodeDraggingScope.shadowElements.length = 0;\n      }\n\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        this.nodeDraggingScope.draggedNodes.length = 0;\n        this.draggedElements.length = 0;\n        this.dragOffsets.length = 0;\n      }\n    });\n  }\n\n}\n\nexport interface NodeDraggingScope {\n  draggedNodes: Array<FcNode>;\n  shadowElements: Array<JQuery<HTMLElement>>;\n  shadowDragStarted: boolean;\n  dropElement: HTMLElement;\n}\n\nexport interface NodeDropElement extends HTMLElement {\n  offsetInfo?: {\n    offsetX: number;\n    offsetY: number;\n  };\n}\n\nexport interface NodeDropScope {\n  dropElement: NodeDropElement;\n}\n\nexport interface DropNodeInfo {\n  node: FcNode;\n  dropTargetId: string;\n  offsetX: number;\n  offsetY: number;\n}\n","import { Injectable } from '@angular/core';\nimport { FcCoords, FlowchartConstants } from './ngx-flowchart.models';\n\n@Injectable()\nexport class FcEdgeDrawingService {\n\n  constructor() {\n  }\n\n  public getEdgeDAttribute(pt1: FcCoords, pt2: FcCoords, style: string): string {\n    let dAddribute = `M ${pt1.x}, ${pt1.y} `;\n    if (style === FlowchartConstants.curvedStyle) {\n      const sourceTangent = this.computeEdgeSourceTangent(pt1, pt2);\n      const destinationTangent = this.computeEdgeDestinationTangent(pt1, pt2);\n      dAddribute += `C ${sourceTangent.x}, ${sourceTangent.y} ${(destinationTangent.x - 50)}, ${destinationTangent.y} ${pt2.x}, ${pt2.y}`;\n    } else {\n      dAddribute += `L ${pt2.x}, ${pt2.y}`;\n    }\n    return dAddribute;\n  }\n\n  public getEdgeCenter(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: (pt1.x + pt2.x) / 2,\n      y: (pt1.y + pt2.y) / 2\n    };\n  }\n\n  private computeEdgeTangentOffset(pt1: FcCoords, pt2: FcCoords): number {\n    return (pt2.y - pt1.y) / 2;\n  }\n\n  private computeEdgeSourceTangent(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: pt1.x,\n      y: pt1.y + this.computeEdgeTangentOffset(pt1, pt2)\n    };\n  }\n\n  private computeEdgeDestinationTangent(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: pt2.x,\n      y: pt2.y - this.computeEdgeTangentOffset(pt1, pt2)\n    };\n  }\n\n}\n","import { FcModelService } from './model.service';\nimport { FcConnector, FcCoords, FcEdge, FcModel, FlowchartConstants, ModelvalidationError } from './ngx-flowchart.models';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { FcModelValidationService } from './modelvalidation.service';\n\nexport class FcEdgeDraggingService {\n\n  edgeDragging: EdgeDragging = {\n    isDragging: false,\n    dragPoint1: null,\n    dragPoint2: null,\n    shadowDragStarted: false\n  };\n\n  private draggedEdgeSource: FcConnector = null;\n  private dragOffset: FcCoords = {};\n  private destinationHtmlElement: HTMLElement = null;\n  private oldDisplayStyle = '';\n\n  private readonly modelValidation: FcModelValidationService;\n  private readonly edgeDrawingService: FcEdgeDrawingService;\n  private readonly modelService: FcModelService;\n  private readonly model: FcModel;\n  private readonly isValidEdgeCallback: (source: FcConnector, destination: FcConnector) => boolean;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n  private readonly dragAnimation: string;\n  private readonly edgeStyle: string;\n\n  constructor(modelValidation: FcModelValidationService,\n              edgeDrawingService: FcEdgeDrawingService,\n              modelService: FcModelService,\n              model: FcModel,\n              isValidEdgeCallback: (source: FcConnector, destination: FcConnector) => boolean,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T,\n              dragAnimation: string,\n              edgeStyle: string) {\n    this.modelValidation = modelValidation;\n    this.edgeDrawingService = edgeDrawingService;\n    this.modelService = modelService;\n    this.model = model;\n    this.isValidEdgeCallback = isValidEdgeCallback || (() => true);\n    this.applyFunction = applyFunction;\n    this.dragAnimation = dragAnimation;\n    this.edgeStyle = edgeStyle;\n  }\n\n  public dragstart(event: DragEvent, connector: FcConnector) {\n    let swapConnector: FcConnector;\n    let dragLabel: string;\n    let prevEdge: FcEdge;\n    if (connector.type === FlowchartConstants.leftConnectorType) {\n      for (const edge of this.model.edges) {\n        if (edge === connector.id) {\n          swapConnector = this.modelService.connectors.getConnector(edge.source);\n          dragLabel = edge.label;\n          prevEdge = edge;\n          this.applyFunction(() => {\n            this.modelService.edges.delete(edge);\n          });\n          break;\n        }\n      }\n    }\n    this.edgeDragging.isDragging = true;\n    if (swapConnector !== undefined) {\n      this.draggedEdgeSource = swapConnector;\n      this.edgeDragging.dragPoint1 = this.modelService.connectors.getCenteredCoord(swapConnector.id);\n      this.edgeDragging.dragLabel = dragLabel;\n      this.edgeDragging.prevEdge = prevEdge;\n    } else {\n      this.draggedEdgeSource = connector;\n      this.edgeDragging.dragPoint1 = this.modelService.connectors.getCenteredCoord(connector.id);\n    }\n    const canvas = this.modelService.canvasHtmlElement;\n    if (!canvas) {\n      throw new Error('No canvas while edgedraggingService found.');\n    }\n    this.dragOffset.x = -canvas.getBoundingClientRect().left;\n    this.dragOffset.y = -canvas.getBoundingClientRect().top;\n\n    this.edgeDragging.dragPoint2 = {\n      x: event.clientX + this.dragOffset.x,\n      y: event.clientY + this.dragOffset.y\n    };\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n\n    originalEvent.dataTransfer.setData('Text', 'Just to support firefox');\n    if (originalEvent.dataTransfer.setDragImage) {\n      originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n    } else {\n      this.destinationHtmlElement = event.target as HTMLElement;\n      this.oldDisplayStyle = this.destinationHtmlElement.style.display;\n      this.destinationHtmlElement.style.display = 'none';\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        this.edgeDragging.shadowDragStarted = true;\n      }\n    }\n    if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      if (this.edgeDragging.gElement === undefined) {\n        this.edgeDragging.gElement = $(document.querySelectorAll('.shadow-svg-class'));\n        this.edgeDragging.pathElement = $(document.querySelectorAll('.shadow-svg-class')).find('path');\n        this.edgeDragging.circleElement = $(document.querySelectorAll('.shadow-svg-class')).find('circle');\n      }\n\n      this.edgeDragging.gElement.css('display', 'block');\n      this.edgeDragging.pathElement.attr('d',\n        this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n      this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n      this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n    }\n    event.stopPropagation();\n  }\n\n  public dragover(event: DragEvent) {\n    if (this.edgeDragging.isDragging) {\n      if (!this.edgeDragging.magnetActive && this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        if (this.destinationHtmlElement !== null) {\n          this.destinationHtmlElement.style.display = this.oldDisplayStyle;\n        }\n\n        if (this.edgeDragging.shadowDragStarted) {\n          this.applyFunction(() => {\n            this.edgeDragging.shadowDragStarted = false;\n          });\n        }\n\n        this.edgeDragging.dragPoint2 = {\n          x: event.clientX + this.dragOffset.x,\n          y: event.clientY + this.dragOffset.y\n        };\n\n        this.edgeDragging.pathElement.attr('d',\n          this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n        this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n        this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n\n      } else if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n        return this.applyFunction(() => {\n          if (this.destinationHtmlElement !== null) {\n            this.destinationHtmlElement.style.display = this.oldDisplayStyle;\n          }\n\n          this.edgeDragging.dragPoint2 = {\n            x: event.clientX + this.dragOffset.x,\n            y: event.clientY + this.dragOffset.y\n          };\n        });\n      }\n    }\n  }\n\n  public dragoverConnector(event: DragEvent, connector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      this.dragover(event);\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: connector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, connector)) {\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n      }\n    }\n  }\n\n  public dragleaveMagnet(event: DragEvent) {\n    this.edgeDragging.magnetActive = false;\n  }\n\n  public dragoverMagnet(event: DragEvent, connector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      this.dragover(event);\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: connector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, connector)) {\n        if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n\n          this.edgeDragging.magnetActive = true;\n\n          this.edgeDragging.dragPoint2 = this.modelService.connectors.getCenteredCoord(connector.id);\n          this.edgeDragging.pathElement.attr('d',\n            this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n          this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n          this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        } else if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n          return this.applyFunction(() => {\n            this.edgeDragging.dragPoint2 = this.modelService.connectors.getCenteredCoord(connector.id);\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n          });\n        }\n      }\n    }\n  }\n\n  public dragend(event: DragEvent) {\n    if (this.edgeDragging.isDragging) {\n      this.edgeDragging.isDragging = false;\n      this.edgeDragging.dragPoint1 = null;\n      this.edgeDragging.dragPoint2 = null;\n      this.edgeDragging.dragLabel = null;\n      event.stopPropagation();\n\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        this.edgeDragging.gElement.css('display', 'none');\n      }\n      if (this.edgeDragging.prevEdge) {\n        const edge = this.edgeDragging.prevEdge;\n        this.edgeDragging.prevEdge = null;\n        this.applyFunction(() => {\n          this.modelService.edges.putEdge(edge);\n        });\n      }\n    }\n  }\n\n  public drop(event: DragEvent, targetConnector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: targetConnector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, targetConnector)) {\n        this.edgeDragging.prevEdge = null;\n        this.modelService.edges._addEdge(event, this.draggedEdgeSource, targetConnector, this.edgeDragging.dragLabel);\n        event.stopPropagation();\n        event.preventDefault();\n        return false;\n      }\n    }\n  }\n}\n\nexport interface EdgeDragging {\n  isDragging: boolean;\n  shadowDragStarted: boolean;\n  dragPoint1: FcCoords;\n  dragPoint2: FcCoords;\n  dragLabel?: string;\n  prevEdge?: FcEdge;\n  magnetActive?: boolean;\n  gElement?: JQuery<Element>;\n  pathElement?: JQuery<Element>;\n  circleElement?: JQuery<Element>;\n}\n","import { FcConnector, FcEdge, FcNode } from './ngx-flowchart.models';\n\nexport class FcMouseOverService {\n\n  mouseoverscope: MouseOverScope = {\n    connector: null,\n    edge: null,\n    node: null\n  };\n\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(applyFunction: <T>(fn: (...args: any[]) => T) => T) {\n    this.applyFunction = applyFunction;\n  }\n\n  public nodeMouseOver(event: MouseEvent, node: FcNode) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.node = node;\n    });\n  }\n\n  public nodeMouseOut(event: MouseEvent, node: FcNode) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.node = null;\n    });\n  }\n\n  public connectorMouseEnter(event: MouseEvent, connector: FcConnector) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.connector = connector;\n    });\n  }\n\n  public connectorMouseLeave(event: MouseEvent, connector: FcConnector) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.connector = null;\n    });\n  }\n\n  public edgeMouseEnter(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverscope.edge = edge;\n  }\n\n  public edgeMouseLeave(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverscope.edge = null;\n  }\n}\n\nexport interface MouseOverScope {\n  connector: FcConnector;\n  edge: FcEdge;\n  node: FcNode;\n}\n","const regex = /(auto|scroll)/;\n\nconst style = (node: Element, prop: string): string =>\n  getComputedStyle(node, null).getPropertyValue(prop);\n\nconst scroll = (node: Element) =>\n  regex.test(\n    style(node, 'overflow') +\n    style(node, 'overflow-y') +\n    style(node, 'overflow-x'));\n\nconst scrollparent = (node: HTMLElement): HTMLElement =>\n  !node || node === document.body\n    ? document.body\n    : scroll(node)\n    ? node\n    : scrollparent(node.parentNode as HTMLElement);\n\nexport default scrollparent;\n","import { FcModelService } from './model.service';\nimport { FcRectBox } from './ngx-flowchart.models';\nimport scrollparent from './scrollparent';\n\ninterface Rectangle {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nexport class FcRectangleSelectService {\n\n  private readonly selectRect: Rectangle = {\n    x1: 0,\n    x2: 0,\n    y1: 0,\n    y2: 0\n  };\n\n  private readonly modelService: FcModelService;\n  private readonly selectElement: HTMLElement;\n  private readonly $canvasElement: JQuery<HTMLElement>;\n  private readonly $scrollParent: JQuery<HTMLElement>;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(modelService: FcModelService,\n              selectElement: HTMLElement,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T) {\n    this.modelService = modelService;\n    this.selectElement = selectElement;\n    this.$canvasElement = $(this.modelService.canvasHtmlElement);\n    this.$scrollParent = $(scrollparent(this.modelService.canvasHtmlElement));\n    this.applyFunction = applyFunction;\n  }\n\n  public mousedown(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && this.selectElement.hidden) {\n      this.selectElement.hidden = false;\n      const offset = this.$canvasElement.offset();\n      this.selectRect.x1 = Math.round(e.pageX - offset.left);\n      this.selectRect.y1 = Math.round(e.pageY - offset.top);\n      this.selectRect.x2 = this.selectRect.x1;\n      this.selectRect.y2 = this.selectRect.y1;\n      this.updateSelectRect();\n    }\n  }\n\n  public mousemove(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && !this.selectElement.hidden) {\n      const offset = this.$canvasElement.offset();\n      this.selectRect.x2 = Math.round(e.pageX - offset.left);\n      this.selectRect.y2 = Math.round(e.pageY - offset.top);\n      this.updateScroll(offset);\n      this.updateSelectRect();\n    }\n  }\n\n  private updateScroll(offset: JQuery.Coordinates) {\n    const rect = this.$scrollParent[0].getBoundingClientRect();\n    const bottom = rect.bottom - offset.top;\n    const right = rect.right - offset.left;\n    const top = rect.top - offset.top;\n    const left = rect.left - offset.left;\n    if (this.selectRect.y2 - top < 25) {\n      const topScroll = 25 - (this.selectRect.y2 - top);\n      const scroll = this.$scrollParent.scrollTop();\n      this.$scrollParent.scrollTop(scroll - topScroll);\n    } else if (bottom - this.selectRect.y2 < 40) {\n      const bottomScroll = 40 - (bottom - this.selectRect.y2);\n      const scroll = this.$scrollParent.scrollTop();\n      this.$scrollParent.scrollTop(scroll + bottomScroll);\n    }\n    if (this.selectRect.x2 - left < 25) {\n      const leftScroll = 25 - (this.selectRect.x2 - left);\n      const scroll = this.$scrollParent.scrollLeft();\n      this.$scrollParent.scrollLeft(scroll - leftScroll);\n    } else if (right - this.selectRect.x2 < 40) {\n      const rightScroll = 40 - (right - this.selectRect.x2);\n      const scroll = this.$scrollParent.scrollLeft();\n      this.$scrollParent.scrollLeft(scroll + rightScroll);\n    }\n  }\n\n  public mouseup(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && !this.selectElement.hidden) {\n      const rectBox = this.selectElement.getBoundingClientRect() as FcRectBox;\n      this.selectElement.hidden = true;\n      this.selectObjects(rectBox);\n    }\n  }\n\n  private updateSelectRect() {\n    const x3 = Math.min(this.selectRect.x1, this.selectRect.x2);\n    const x4 = Math.max(this.selectRect.x1, this.selectRect.x2);\n    const y3 = Math.min(this.selectRect.y1, this.selectRect.y2);\n    const y4 = Math.max(this.selectRect.y1, this.selectRect.y2);\n    this.selectElement.style.left = x3 + 'px';\n    this.selectElement.style.top = y3 + 'px';\n    this.selectElement.style.width = x4 - x3 + 'px';\n    this.selectElement.style.height = y4 - y3 + 'px';\n  }\n\n  private selectObjects(rectBox: FcRectBox) {\n    this.applyFunction(() => {\n      this.modelService.selectAllInRect(rectBox);\n    });\n  }\n\n}\n\n","import {\n  ChangeDetectionStrategy, ChangeDetectorRef,\n  Component,\n  DoCheck,\n  ElementRef,\n  HostBinding,\n  HostListener,\n  Input,\n  IterableDiffer,\n  IterableDiffers,\n  NgZone,\n  OnInit\n} from '@angular/core';\nimport { FcCallbacks, FcEdge, FcModel, FcNode, FlowchartConstants, UserCallbacks, UserNodeCallbacks } from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\nimport { FcModelValidationService } from './modelvalidation.service';\nimport { FcNodeDraggingService } from './node-dragging.service';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { FcEdgeDraggingService } from './edge-dragging.service';\nimport { FcMouseOverService } from './mouseover.service';\nimport { FcRectangleSelectService } from './rectangleselect.service';\n\n@Component({\n  selector: 'fc-canvas',\n  templateUrl: './ngx-flowchart.component.html',\n  styleUrls: ['./ngx-flowchart.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class NgxFlowchartComponent implements OnInit, DoCheck {\n\n  @HostBinding('attr.class')\n  get canvasClass(): string {\n    return FlowchartConstants.canvasClass;\n  }\n\n  @Input()\n  model: FcModel;\n\n  @Input()\n  selectedObjects: any[];\n\n  @Input()\n  edgeStyle: string;\n\n  @Input()\n  userCallbacks: UserCallbacks;\n\n  @Input()\n  automaticResize: boolean;\n\n  @Input()\n  dragAnimation: string;\n\n  @Input()\n  nodeWidth: number;\n\n  @Input()\n  nodeHeight: number;\n\n  @Input()\n  dropTargetId: string;\n\n  callbacks: FcCallbacks;\n\n  userNodeCallbacks: UserNodeCallbacks;\n\n  modelService: FcModelService;\n  nodeDraggingService: FcNodeDraggingService;\n  edgeDraggingService: FcEdgeDraggingService;\n  mouseoverService: FcMouseOverService;\n  rectangleSelectService: FcRectangleSelectService;\n\n  arrowDefId: string;\n  arrowDefIdSelected: string;\n\n  flowchartConstants = FlowchartConstants;\n\n  private nodesDiffer: IterableDiffer<FcNode> = this.differs.find([]).create<FcNode>((index, item) => {\n    return item;\n  });\n\n  private edgesDiffer: IterableDiffer<FcEdge> = this.differs.find([]).create<FcEdge>((index, item) => {\n    return item;\n  });\n\n  constructor(private elementRef: ElementRef<HTMLElement>,\n              private differs: IterableDiffers,\n              private modelValidation: FcModelValidationService,\n              public edgeDrawingService: FcEdgeDrawingService,\n              private cd: ChangeDetectorRef,\n              private zone: NgZone) {\n    this.arrowDefId = 'arrow-' + Math.random();\n    this.arrowDefIdSelected = this.arrowDefId + '-selected';\n  }\n\n  ngOnInit() {\n    if (!this.dropTargetId && this.edgeStyle !== FlowchartConstants.curvedStyle && this.edgeStyle !== FlowchartConstants.lineStyle) {\n      throw new Error('edgeStyle not supported.');\n    }\n    this.nodeHeight = this.nodeHeight || 200;\n    this.nodeWidth = this.nodeWidth || 200;\n    this.dragAnimation = this.dragAnimation || FlowchartConstants.dragAnimationRepaint;\n    this.userCallbacks = this.userCallbacks || {};\n    this.automaticResize = this.automaticResize || false;\n\n    for (const key of Object.keys(this.userCallbacks)) {\n      const callback = this.userCallbacks[key];\n      if (typeof callback !== 'function' && key !== 'nodeCallbacks') {\n        throw new Error('All callbacks should be functions.');\n      }\n    }\n\n    this.userNodeCallbacks = this.userCallbacks.nodeCallbacks;\n\n    const element = $(this.elementRef.nativeElement);\n\n    this.modelService = new FcModelService(this.modelValidation, this.model, this.cd, this.selectedObjects,\n      this.userCallbacks.dropNode, this.userCallbacks.createEdge, this.userCallbacks.edgeAdded, this.userCallbacks.nodeRemoved,\n      this.userCallbacks.edgeRemoved, element[0], element[0].querySelector('svg'));\n\n    if (this.dropTargetId) {\n      this.modelService.dropTargetId = this.dropTargetId;\n    }\n\n    const applyFunction = this.zone.run.bind(this.zone);\n\n    this.nodeDraggingService = new FcNodeDraggingService(this.modelService, applyFunction,\n          this.automaticResize, this.dragAnimation);\n\n    this.edgeDraggingService = new FcEdgeDraggingService(this.modelValidation, this.edgeDrawingService, this.modelService,\n      this.model, this.userCallbacks.isValidEdge || null, applyFunction,\n      this.dragAnimation, this.edgeStyle);\n\n    this.mouseoverService = new FcMouseOverService(applyFunction);\n\n    this.rectangleSelectService = new FcRectangleSelectService(this.modelService,\n      element[0].querySelector('#select-rectangle'), applyFunction);\n\n    this.callbacks = {\n      nodeDragstart: this.nodeDraggingService.dragstart.bind(this.nodeDraggingService),\n      nodeDragend: this.nodeDraggingService.dragend.bind(this.nodeDraggingService),\n      edgeDragstart: this.edgeDraggingService.dragstart.bind(this.edgeDraggingService),\n      edgeDragend: this.edgeDraggingService.dragend.bind(this.edgeDraggingService),\n      edgeDrop: this.edgeDraggingService.drop.bind(this.edgeDraggingService),\n      edgeDragoverConnector: this.edgeDraggingService.dragoverConnector.bind(this.edgeDraggingService),\n      edgeDragoverMagnet: this.edgeDraggingService.dragoverMagnet.bind(this.edgeDraggingService),\n      edgeDragleaveMagnet: this.edgeDraggingService.dragleaveMagnet.bind(this.edgeDraggingService),\n      nodeMouseOver: this.mouseoverService.nodeMouseOver.bind(this.mouseoverService),\n      nodeMouseOut: this.mouseoverService.nodeMouseOut.bind(this.mouseoverService),\n      connectorMouseEnter: this.mouseoverService.connectorMouseEnter.bind(this.mouseoverService),\n      connectorMouseLeave: this.mouseoverService.connectorMouseLeave.bind(this.mouseoverService),\n      nodeClicked: (event, node) => {\n        this.modelService.nodes.handleClicked(node, event.ctrlKey);\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    };\n    this.adjustCanvasSize(true);\n  }\n\n  ngDoCheck(): void {\n    if (this.model) {\n      const nodesChange = this.nodesDiffer.diff(this.model.nodes);\n      const edgesChange = this.edgesDiffer.diff(this.model.edges);\n      let nodesChanged = false;\n      let edgesChanged = false;\n      if (nodesChange !== null) {\n        nodesChange.forEachAddedItem(() => {\n          nodesChanged = true;\n        });\n        nodesChange.forEachRemovedItem(() => {\n          nodesChanged = true;\n        });\n      }\n      if (edgesChange !== null) {\n        edgesChange.forEachAddedItem(() => {\n          edgesChanged = true;\n        });\n        edgesChange.forEachRemovedItem(() => {\n          edgesChanged = true;\n        });\n      }\n      if (nodesChanged) {\n        this.adjustCanvasSize(true);\n      }\n      if (nodesChanged || edgesChanged) {\n        this.cd.detectChanges();\n      }\n    }\n  }\n\n  getEdgeDAttribute(edge: FcEdge): string {\n    return this.edgeDrawingService.getEdgeDAttribute(this.modelService.edges.sourceCoord(edge),\n      this.modelService.edges.destCoord(edge), this.edgeStyle);\n  }\n\n  public adjustCanvasSize(fit?: boolean) {\n    let maxX = 0;\n    let maxY = 0;\n    const element = $(this.elementRef.nativeElement);\n    this.model.nodes.forEach((node) => {\n      maxX = Math.max(node.x + this.nodeWidth, maxX);\n      maxY = Math.max(node.y + this.nodeHeight, maxY);\n    });\n    let width;\n    let height;\n    if (fit) {\n      width = maxX;\n      height = maxY;\n    } else {\n      width = Math.max(maxX, element.prop('offsetWidth'));\n      height = Math.max(maxY, element.prop('offsetHeight'));\n    }\n    element.css('width', width + 'px');\n    element.css('height', height + 'px');\n  }\n\n  canvasClick(event: MouseEvent) {}\n\n  edgeMouseDown(event: MouseEvent, edge: FcEdge) {\n    event.stopPropagation();\n  }\n\n  edgeClick(event: MouseEvent, edge: FcEdge) {\n    this.modelService.edges.handleEdgeMouseClick(edge, event.ctrlKey);\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  edgeRemove(event: Event, edge: FcEdge) {\n    this.modelService.edges.delete(edge);\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  edgeEdit(event: Event, edge: FcEdge) {\n    if (this.userCallbacks.edgeEdit) {\n      this.userCallbacks.edgeEdit(event, edge);\n    }\n  }\n\n  edgeDoubleClick(event: MouseEvent, edge: FcEdge) {\n    if (this.userCallbacks.edgeDoubleClick) {\n      this.userCallbacks.edgeDoubleClick(event, edge);\n    }\n  }\n\n  edgeMouseOver(event: MouseEvent, edge: FcEdge) {\n    if (this.userCallbacks.edgeMouseOver) {\n      this.userCallbacks.edgeMouseOver(event, edge);\n    }\n  }\n\n  edgeMouseEnter(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverService.edgeMouseEnter(event, edge);\n  }\n\n  edgeMouseLeave(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverService.edgeMouseLeave(event, edge);\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    this.nodeDraggingService.dragover(event);\n    this.edgeDraggingService.dragover(event);\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    if (event.preventDefault) {\n      event.preventDefault();\n    }\n    if (event.stopPropagation) {\n      event.stopPropagation();\n    }\n    this.nodeDraggingService.drop(event);\n  }\n\n  @HostListener('mousedown', ['$event'])\n  mousedown(event: MouseEvent) {\n    this.rectangleSelectService.mousedown(event);\n  }\n\n  @HostListener('mousemove', ['$event'])\n  mousemove(event: MouseEvent) {\n    this.rectangleSelectService.mousemove(event);\n  }\n\n  @HostListener('mouseup', ['$event'])\n  mouseup(event: MouseEvent) {\n    this.rectangleSelectService.mouseup(event);\n  }\n\n}\n","import { Directive, ElementRef, HostListener, Input, OnInit } from '@angular/core';\nimport { FcCallbacks, FcConnector, FlowchartConstants } from './ngx-flowchart.models';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[fc-magnet]'\n})\nexport class FcMagnetDirective implements OnInit {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  connector: FcConnector;\n\n  constructor(public elementRef: ElementRef<HTMLElement>) {\n  }\n\n  ngOnInit(): void {\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.magnetClass);\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    return this.callbacks.edgeDragoverMagnet(event, this.connector);\n  }\n\n  @HostListener('dragleave', ['$event'])\n  dragleave(event: DragEvent) {\n    this.callbacks.edgeDragleaveMagnet(event);\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    return this.callbacks.edgeDrop(event, this.connector);\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    this.callbacks.edgeDragend(event);\n  }\n\n}\n","import { Directive, ElementRef, HostListener, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { FcCallbacks, FcConnector, FlowchartConstants } from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[fc-connector]'\n})\nexport class FcConnectorDirective implements OnInit, OnChanges {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  connector: FcConnector;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  constructor(public elementRef: ElementRef<HTMLElement>) {\n  }\n\n  ngOnInit(): void {\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.connectorClass);\n    if (this.modelservice.isEditable()) {\n      element.attr('draggable', 'true');\n      this.updateConnectorClass();\n    }\n    this.modelservice.connectors.setHtmlElement(this.connector.id, element[0]);\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    let updateConnector = false;\n    for (const propName of Object.keys(changes)) {\n      const change = changes[propName];\n      if (!change.firstChange && change.currentValue !== change.previousValue) {\n        if (propName === 'mouseOverConnector') {\n          updateConnector = true;\n        }\n      }\n    }\n    if (updateConnector && this.modelservice.isEditable()) {\n      this.updateConnectorClass();\n    }\n  }\n\n  private updateConnectorClass() {\n    const element = $(this.elementRef.nativeElement);\n    if (this.connector === this.mouseOverConnector) {\n      element.addClass(FlowchartConstants.hoverClass);\n    } else {\n      element.removeClass(FlowchartConstants.hoverClass);\n    }\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    // Skip - conflict with magnet\n    /* if (this.modelservice.isEditable()) {\n      return this.callbacks.edgeDragoverConnector(event, this.connector);\n    }*/\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      return this.callbacks.edgeDrop(event, this.connector);\n    }\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.edgeDragend(event);\n    }\n  }\n\n  @HostListener('dragstart', ['$event'])\n  dragstart(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.edgeDragstart(event, this.connector);\n    }\n  }\n\n  @HostListener('mouseenter', ['$event'])\n  mouseenter(event: MouseEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.connectorMouseEnter(event, this.connector);\n    }\n  }\n\n  @HostListener('mouseleave', ['$event'])\n  mouseleave(event: MouseEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.connectorMouseLeave(event, this.connector);\n    }\n  }\n\n}\n","import {\n  Component,\n  ComponentFactoryResolver, Directive,\n  ElementRef, HostBinding,\n  HostListener,\n  Inject,\n  Input,\n  OnChanges,\n  OnInit,\n  SimpleChanges,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport {\n  FC_NODE_COMPONENT_CONFIG,\n  FcCallbacks,\n  FcConnector,\n  FcNode,\n  FcNodeComponentConfig,\n  FlowchartConstants,\n  UserNodeCallbacks\n} from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\n\n@Component({\n  selector: 'fc-node',\n  template: '<ng-template #nodeContent></ng-template>',\n  styleUrls: ['./node.component.scss']\n})\nexport class FcNodeContainerComponent implements OnInit, OnChanges {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  userNodeCallbacks: UserNodeCallbacks;\n\n  @Input()\n  node: FcNode;\n\n  @Input()\n  selected: boolean;\n\n  @Input()\n  edit: boolean;\n\n  @Input()\n  underMouse: boolean;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  dragging: boolean;\n\n  @HostBinding('attr.id')\n  get nodeId(): string {\n    return this.node.id;\n  }\n\n  @HostBinding('style.top')\n  get top(): string {\n    return this.node.y + 'px';\n  }\n\n  @HostBinding('style.left')\n  get left(): string {\n    return this.node.x + 'px';\n  }\n\n  nodeComponent: FcNodeComponent;\n\n  @ViewChild('nodeContent', {read: ViewContainerRef, static: true}) nodeContentContainer: ViewContainerRef;\n\n  constructor(@Inject(FC_NODE_COMPONENT_CONFIG) private nodeComponentConfig: FcNodeComponentConfig,\n              private elementRef: ElementRef<HTMLElement>,\n              private componentFactoryResolver: ComponentFactoryResolver) {\n  }\n\n  ngOnInit(): void {\n    if (!this.userNodeCallbacks) {\n      this.userNodeCallbacks = {};\n    }\n    this.userNodeCallbacks.nodeEdit = this.userNodeCallbacks.nodeEdit || (() => {});\n    this.userNodeCallbacks.doubleClick = this.userNodeCallbacks.doubleClick || (() => {});\n    this.userNodeCallbacks.mouseDown = this.userNodeCallbacks.mouseDown || (() => {});\n    this.userNodeCallbacks.mouseEnter = this.userNodeCallbacks.mouseEnter || (() => {});\n    this.userNodeCallbacks.mouseLeave = this.userNodeCallbacks.mouseLeave || (() => {});\n\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.nodeClass);\n    if (!this.node.readonly) {\n      element.attr('draggable', 'true');\n    }\n    this.updateNodeClass();\n    this.modelservice.nodes.setHtmlElement(this.node.id, element[0]);\n    this.nodeContentContainer.clear();\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(this.nodeComponentConfig.nodeComponentType);\n    const componentRef = this.nodeContentContainer.createComponent(componentFactory);\n    this.nodeComponent = componentRef.instance;\n    this.nodeComponent.callbacks = this.callbacks;\n    this.nodeComponent.userNodeCallbacks = this.userNodeCallbacks;\n    this.nodeComponent.node = this.node;\n    this.nodeComponent.modelservice = this.modelservice;\n    this.updateNodeComponent();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    let updateNode = false;\n    for (const propName of Object.keys(changes)) {\n      const change = changes[propName];\n      if (!change.firstChange && change.currentValue !== change.previousValue) {\n        if (['selected', 'edit', 'underMouse', 'mouseOverConnector', 'dragging'].includes(propName)) {\n          updateNode = true;\n        }\n      }\n    }\n    if (updateNode) {\n      this.updateNodeClass();\n      this.updateNodeComponent();\n    }\n  }\n\n  private updateNodeClass() {\n    const element = $(this.elementRef.nativeElement);\n    this.toggleClass(element, FlowchartConstants.selectedClass, this.selected);\n    this.toggleClass(element, FlowchartConstants.editClass, this.edit);\n    this.toggleClass(element, FlowchartConstants.hoverClass, this.underMouse);\n    this.toggleClass(element, FlowchartConstants.draggingClass, this.dragging);\n  }\n\n  private updateNodeComponent() {\n    this.nodeComponent.selected = this.selected;\n    this.nodeComponent.edit = this.edit;\n    this.nodeComponent.underMouse = this.underMouse;\n    this.nodeComponent.mouseOverConnector = this.mouseOverConnector;\n    this.nodeComponent.dragging = this.dragging;\n  }\n\n  private toggleClass(element: JQuery<HTMLElement>, clazz: string, set: boolean) {\n    if (set) {\n      element.addClass(clazz);\n    } else {\n      element.removeClass(clazz);\n    }\n  }\n\n  @HostListener('mousedown', ['$event'])\n  mousedown(event: MouseEvent) {\n    event.stopPropagation();\n  }\n\n  @HostListener('dragstart', ['$event'])\n  dragstart(event: DragEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeDragstart(event, this.node);\n    }\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeDragend(event);\n    }\n  }\n\n  @HostListener('click', ['$event'])\n  click(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeClicked(event, this.node);\n    }\n  }\n\n  @HostListener('mouseover', ['$event'])\n  mouseover(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeMouseOver(event, this.node);\n    }\n  }\n\n  @HostListener('mouseout', ['$event'])\n  mouseout(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeMouseOut(event, this.node);\n    }\n  }\n\n}\n\nexport abstract class FcNodeComponent implements OnInit {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  userNodeCallbacks: UserNodeCallbacks;\n\n  @Input()\n  node: FcNode;\n\n  @Input()\n  selected: boolean;\n\n  @Input()\n  edit: boolean;\n\n  @Input()\n  underMouse: boolean;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  dragging: boolean;\n\n  flowchartConstants = FlowchartConstants;\n\n  ngOnInit(): void {\n  }\n\n}\n","import { Component } from '@angular/core';\nimport { FcNodeComponent } from './node.component';\n\n@Component({\n  selector: 'fc-default-node',\n  templateUrl: './default-node.component.html',\n  styleUrls: ['./default-node.component.scss']\n})\nexport class DefaultFcNodeComponent extends FcNodeComponent {\n\n  constructor() {\n    super();\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { NgxFlowchartComponent } from './ngx-flowchart.component';\nimport { FcModelValidationService } from './modelvalidation.service';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { CommonModule } from '@angular/common';\nimport { FcMagnetDirective } from './magnet.directive';\nimport { FcConnectorDirective } from './connector.directive';\nimport { FcNodeContainerComponent } from './node.component';\nimport { FC_NODE_COMPONENT_CONFIG } from './ngx-flowchart.models';\nimport { DefaultFcNodeComponent } from './default-node.component';\n\n@NgModule({\n  entryComponents: [\n    DefaultFcNodeComponent\n  ],\n  declarations: [NgxFlowchartComponent,\n    FcMagnetDirective,\n    FcConnectorDirective,\n    FcNodeContainerComponent,\n    DefaultFcNodeComponent],\n  providers: [\n    FcModelValidationService,\n    FcEdgeDrawingService,\n    {\n      provide: FC_NODE_COMPONENT_CONFIG,\n      useValue: {\n        nodeComponentType: DefaultFcNodeComponent\n      }\n    }\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [NgxFlowchartComponent,\n    FcMagnetDirective,\n    FcConnectorDirective,\n    DefaultFcNodeComponent]\n})\nexport class NgxFlowchartModule { }\n"]}