{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ngx-flowchart/lib/ngx-flowchart.models.ts","ng://ngx-flowchart/lib/model.service.ts","ng://ngx-flowchart/lib/modelvalidation.service.ts","ng://ngx-flowchart/lib/node-dragging.service.ts","ng://ngx-flowchart/lib/edge-drawing.service.ts","ng://ngx-flowchart/lib/edge-dragging.service.ts","ng://ngx-flowchart/lib/mouseover.service.ts","ng://ngx-flowchart/lib/scrollparent.ts","ng://ngx-flowchart/lib/rectangleselect.service.ts","ng://ngx-flowchart/lib/node.component.ts","ng://ngx-flowchart/lib/ngx-flowchart.component.html","ng://ngx-flowchart/lib/ngx-flowchart.component.ts","ng://ngx-flowchart/lib/magnet.directive.ts","ng://ngx-flowchart/lib/connector.directive.ts","ng://ngx-flowchart/lib/default-node.component.html","ng://ngx-flowchart/lib/default-node.component.ts","ng://ngx-flowchart/lib/ngx-flowchart.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__values","o","m","Symbol","iterator","next","value","done","FC_NODE_COMPONENT_CONFIG","InjectionToken","FlowchartConstants","htmlPrefix","leftConnectorType","rightConnectorType","curvedStyle","lineStyle","dragAnimationRepaint","dragAnimationShadow","canvasClass","selectedClass","editClass","activeClass","hoverClass","draggingClass","edgeClass","edgeLabelClass","connectorClass","magnetClass","nodeClass","nodeOverlayClass","leftConnectorClass","rightConnectorClass","canvasResizeThreshold","canvasResizeStep","BaseError","Error","defineProperty","ModelvalidationError","message","_this","_super","fcTopSort","graph","adjacentList","nodes","forEach","node","id","incoming","outgoing","edges","edge","sourceNode","filter","connectors","some","connector","source","destinationNode","destination","push","orderedNodes","sourceNodes","_c","keys","_d","pop","splice","hasEdges","_e","_f","FcModelService","modelValidation","model","modelChanged","detectChangesSubject","selectedObjects","dropNode","createEdge","edgeAddedCallback","nodeRemovedCallback","edgeRemovedCallback","canvasHtmlElement","svgHtmlElement","connectorsRectInfos","nodesHtmlElements","dragImage","debouncer","Subject","validateModel","event","of","label","ConnectorsModel","NodesModel","EdgesModel","pipe","debounceTime","subscribe","emit","notifyModelChanged","detectChanges","setTimeout","selectObject","object","isEditable","indexOf","deselectObject","index","toggleSelectedObject","isSelectedObject","selectAll","readonly","select","deselectAll","isEditObject","inRectBox","x","y","rectBox","left","right","top","bottom","getItemInfoAtPoint","getNodeAtPoint","getEdgeAtPoint","_b","nodeElementBox","getHtmlElement","getBoundingClientRect","document","elementFromPoint","edgeIndex","startsWith","Number","substring","selectAllInRect","width","height","isSelected","deselect","canvasElementBox","start","sourceCoord","end","destCoord","deleteSelected","getSelectedEdges","delete","getSelectedNodes","undefined","dropTargetId","isDropSource","getDragImage","Image","src","style","visibility","AbstractFcModel","modelService","toggleSelected","isEdit","getConnector","connectorId","e_3","getConnectorRectInfo","setConnectorRectInfo","connectorRectInfo","_getCoords","centered","canvas","type","nodeRectInfo","Math","round","getCoords","getCenteredCoord","getConnectorsByType","_addConnector","validateNode","error","connectorIds","getConnectorIds","handleClicked","ctrlKey","_addNode","validateNodes","map","getNodeByConnectorId","nodeId","setHtmlElement","element","handleEdgeMouseClick","putEdge","_addEdge","sourceConnector","destConnector","validateConnector","validateEdges","concat","created","FcModelValidationService","_validateEdges","ids","name","isArray","_validateEdge","edge1","index1","edge2","index2","validateEdge","factory","ɵfac","nodeDropScope","dropElement","FcNodeDraggingService","applyFunction","automaticResize","dragAnimation","nodeDraggingScope","shadowDragStarted","draggedNodes","shadowElements","dragOffsets","draggedElements","destinationHtmlElements","oldDisplayStyles","getCoordinate","coordinate","max","min","getXCoordinate","offsetWidth","getYCoordinate","offsetHeight","resizeCanvas","draggedNode","nodeElement","canvasElement","isDraggingNode","includes","dragstart","elements","selectedNodes","selectedNodes_1","selectedNodes_1_1","selectedNode","$","target","offsetsX","offsetsY","elements_1","elements_1_1","parseInt","css","clientX","clientY","originalEvent","parentNode","removeChild","cloneNode","offset","offsetInfo","offsetX","offsetY","position","pointerEvents","zIndex","body","appendChild","dropNodeInfo","dataTransfer","setData","JSON","stringify","setDragImage","target_1","cloneNode_1","insertBefore","dragOffset","shadowElement","targetInnerNode","children","backgroundColor","draggedElement","display","drop","preventDefault","infoText","getData","parse","e","dragover","dragend","replace","FcEdgeDrawingService","getEdgeDAttribute","pt1","pt2","dAddribute","sourceTangent","computeEdgeSourceTangent","destinationTangent","computeEdgeDestinationTangent","getEdgeCenter","computeEdgeTangentOffset","FcEdgeDraggingService","edgeDrawingService","isValidEdgeCallback","edgeStyle","edgeDragging","isDragging","dragPoint1","dragPoint2","draggedEdgeSource","destinationHtmlElement","oldDisplayStyle","swapConnector","dragLabel","prevEdge","this_1","gElement","querySelectorAll","pathElement","find","circleElement","attr","stopPropagation","magnetActive","dragoverConnector","dragleaveMagnet","dragoverMagnet","edge_1","targetConnector","FcMouseOverService","mouseoverscope","nodeMouseOver","nodeMouseOut","connectorMouseEnter","connectorMouseLeave","edgeMouseEnter","edgeMouseLeave","regex","prop","getComputedStyle","getPropertyValue","scrollparent","test","scroll","FcRectangleSelectService","selectElement","selectRect","x1","x2","y1","y2","$canvasElement","$scrollParent","mousedown","metaKey","button","hidden","pageX","pageY","updateSelectRect","mousemove","updateScroll","rect","topScroll","scroll_1","scrollTop","bottomScroll","scroll_2","leftScroll","scroll_3","scrollLeft","rightScroll","scroll_4","mouseup","selectObjects","x3","x4","y3","y4","FcNodeContainerComponent","nodeComponentConfig","elementRef","componentFactoryResolver","ngOnInit","userNodeCallbacks","nodeEdit","doubleClick","mouseDown","mouseEnter","mouseLeave","nativeElement","addClass","updateNodeClass","modelservice","nodeContentContainer","clear","componentFactory","resolveComponentFactory","nodeComponentType","componentRef","createComponent","nodeComponent","instance","callbacks","updateNodeComponent","ngAfterViewInit","ngOnChanges","changes","updateNode","propName","change","firstChange","currentValue","previousValue","toggleClass","selected","edit","underMouse","dragging","mouseOverConnector","clazz","set","removeClass","nodeDragstart","nodeDragend","click","nodeClicked","mouseover","mouseout","core","ElementRef","ComponentFactoryResolver","selectors","viewQuery","rf","ctx","ViewContainerRef","i0.ɵɵtemplate","FcNodeComponent","flowchartConstants","inputs","i0.ɵɵelementStart","i0.ɵɵlistener","$event","_r59","edge_r56","$implicit","edgeClick","edgeDoubleClick","edgeMouseOver","i0.ɵɵelementEnd","i0.ɵɵadvance","i0.ɵɵattribute","ctx_r50","mouseoverService","active","arrowDefIdSelected","arrowDefId","i0.ɵɵelement","ctx_r51","edgeDraggingService","i0.ɵɵclassMapInterpolate2","i0.ɵɵnamespaceHTML","i0.ɵɵelementContainerStart","i0.ɵɵelementContainerEnd","i0.ɵɵproperty","ctx_r53","node_r65","nodeDraggingService","i0.ɵɵtext","i0.ɵɵtextInterpolate","_r80","edge_r67","NgxFlowchartComponent","differs","cd","zone","EventEmitter","fitModelSizeByDefaultValue","nodesDiffer","item","edgesDiffer","random","coerceBooleanProperty","nodeHeight","nodeWidth","userCallbacks","key","nodeCallbacks","edgeAdded","nodeRemoved","edgeRemoved","querySelector","run","bind","isValidEdge","rectangleSelectService","edgeDragstart","edgeDragend","edgeDrop","edgeDragoverConnector","edgeDragoverMagnet","edgeDragleaveMagnet","adjustCanvasSize","fitModelSizeByDefault","ngDoCheck","nodesChange","diff","edgesChange","nodesChanged_1","edgesChanged_1","forEachAddedItem","forEachRemovedItem","fit","maxX","maxY","canvasClick","edgeMouseDown","edgeRemove","edgeEdit","IterableDiffers","ChangeDetectorRef","NgZone","hostVars","hostBindings","i0.ɵɵnamespaceSVG","FcMagnetDirective","dragleave","FcConnectorDirective","updateConnectorClass","updateConnector","mouseenter","mouseleave","ctx_r86","ctx_r87","ctx_r92","ctx_r94","DefaultFcNodeComponent","features","decls","vars","consts","template","i0.ɵɵclassMap","NgxFlowchartModule","providers","provide","useValue","imports","CommonModule","declarations","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Observable } from 'rxjs';\nimport { InjectionToken, Type } from '@angular/core';\nimport { FcNodeComponent } from './node.component';\n\nexport const FC_NODE_COMPONENT_CONFIG = new InjectionToken<FcNodeComponentConfig>('fc-node.component.config');\n\nexport interface FcNodeComponentConfig {\n  nodeComponentType: Type<FcNodeComponent>;\n}\n\nconst htmlPrefix = 'fc';\nconst leftConnectorType = 'leftConnector';\nconst rightConnectorType = 'rightConnector';\n\nexport const FlowchartConstants = {\n  htmlPrefix,\n  leftConnectorType,\n  rightConnectorType,\n  curvedStyle: 'curved',\n  lineStyle: 'line',\n  dragAnimationRepaint: 'repaint',\n  dragAnimationShadow: 'shadow',\n  canvasClass: htmlPrefix + '-canvas',\n  selectedClass: htmlPrefix + '-selected',\n  editClass: htmlPrefix + '-edit',\n  activeClass: htmlPrefix + '-active',\n  hoverClass: htmlPrefix + '-hover',\n  draggingClass: htmlPrefix + '-dragging',\n  edgeClass: htmlPrefix + '-edge',\n  edgeLabelClass: htmlPrefix + '-edge-label',\n  connectorClass: htmlPrefix + '-connector',\n  magnetClass: htmlPrefix + '-magnet',\n  nodeClass: htmlPrefix + '-node',\n  nodeOverlayClass: htmlPrefix + '-node-overlay',\n  leftConnectorClass: htmlPrefix + '-' + leftConnectorType + 's',\n  rightConnectorClass: htmlPrefix + '-' + rightConnectorType + 's',\n  canvasResizeThreshold: 200,\n  canvasResizeStep: 200\n};\n\n\nexport interface FcCoords {\n  x?: number;\n  y?: number;\n}\n\nexport interface FcRectBox {\n  top: number;\n  left: number;\n  right: number;\n  bottom: number;\n}\n\nexport interface FcConnector {\n  id: string;\n  type: string;\n}\n\nexport interface FcNode extends FcCoords {\n  id: string;\n  name: string;\n  connectors: Array<FcConnector>;\n  readonly?: boolean;\n  [key: string]: any;\n}\n\nexport interface FcNodeRectInfo {\n  width(): number;\n  height(): number;\n  top(): number;\n  left(): number;\n  right(): number;\n  bottom(): number;\n}\n\nexport interface FcConnectorRectInfo {\n  type: string;\n  width: number;\n  height: number;\n  nodeRectInfo: FcNodeRectInfo;\n}\n\nexport interface FcEdge {\n  label?: string;\n  source?: string;\n  destination?: string;\n  active?: boolean;\n}\n\nexport interface FcItemInfo {\n  node?: FcNode;\n  edge?: FcEdge;\n}\n\nexport interface FcModel {\n  nodes: Array<FcNode>;\n  edges: Array<FcEdge>;\n}\n\nexport interface UserCallbacks {\n  dropNode?: (event: Event, node: FcNode) => void;\n  createEdge?: (event: Event, edge: FcEdge) => Observable<FcEdge>;\n  edgeAdded?: (edge: FcEdge) => void;\n  nodeRemoved?: (node: FcNode) => void;\n  edgeRemoved?: (edge: FcEdge) => void;\n  edgeDoubleClick?: (event: MouseEvent, edge: FcEdge) => void;\n  edgeMouseOver?: (event: MouseEvent, edge: FcEdge) => void;\n  isValidEdge?: (source: FcConnector, destination: FcConnector) => boolean;\n  edgeEdit?: (event: Event, edge: FcEdge) => void;\n  nodeCallbacks?: UserNodeCallbacks;\n}\n\nexport interface UserNodeCallbacks {\n  nodeEdit?: (event: MouseEvent, node: FcNode) => void;\n  doubleClick?: (event: MouseEvent, node: FcNode) => void;\n  mouseDown?: (event: MouseEvent, node: FcNode) => void;\n  mouseEnter?: (event: MouseEvent, node: FcNode) => void;\n  mouseLeave?: (event: MouseEvent, node: FcNode) => void;\n}\n\nexport interface FcCallbacks {\n  nodeDragstart: (event: DragEvent, node: FcNode) => void;\n  nodeDragend: (event: DragEvent) => void;\n  edgeDragstart: (event: DragEvent, connector: FcConnector) => void;\n  edgeDragend: (event: DragEvent) => void;\n  edgeDrop: (event: DragEvent, targetConnector: FcConnector) => boolean;\n  edgeDragoverConnector: (event: DragEvent, connector: FcConnector) => boolean;\n  edgeDragoverMagnet: (event: DragEvent, connector: FcConnector) => boolean;\n  edgeDragleaveMagnet: (event: DragEvent) => void;\n  nodeMouseOver: (event: MouseEvent, node: FcNode) => void;\n  nodeMouseOut: (event: MouseEvent, node: FcNode) => void;\n  connectorMouseEnter: (event: MouseEvent, connector: FcConnector) => void;\n  connectorMouseLeave: (event: MouseEvent, connector: FcConnector) => void;\n  nodeClicked: (event: MouseEvent, node: FcNode) => void;\n}\n\nexport interface FcAdjacentList {\n  [id: string]: {\n    incoming: number;\n    outgoing: Array<string>;\n  };\n}\n\nclass BaseError {\n  constructor() {\n    Error.apply(this, arguments);\n  }\n}\n\nObject.defineProperty(BaseError, 'prototype', new Error());\n\nexport class ModelvalidationError extends BaseError {\n  constructor(public message: string) {\n    super();\n  }\n}\n\nexport function fcTopSort(graph: FcModel): Array<string> | null {\n  const adjacentList: FcAdjacentList = {};\n  graph.nodes.forEach((node) => {\n    adjacentList[node.id] = {incoming: 0, outgoing: []};\n  });\n  graph.edges.forEach((edge) => {\n    const sourceNode = graph.nodes.filter((node) => {\n      return node.connectors.some((connector) => {\n        return connector.id === edge.source;\n      });\n    })[0];\n    const destinationNode = graph.nodes.filter((node) => {\n      return node.connectors.some((connector) => {\n        return connector.id === edge.destination;\n      });\n    })[0];\n    adjacentList[sourceNode.id].outgoing.push(destinationNode.id);\n    adjacentList[destinationNode.id].incoming++;\n  });\n  const orderedNodes: string[] = [];\n  const sourceNodes: string[] = [];\n  for (const node of Object.keys(adjacentList)) {\n    const edges = adjacentList[node];\n    if (edges.incoming === 0) {\n      sourceNodes.push(node);\n    }\n  }\n  while (sourceNodes.length !== 0) {\n    const sourceNode = sourceNodes.pop();\n    for (let i = 0; i < adjacentList[sourceNode].outgoing.length; i++) {\n      const destinationNode = adjacentList[sourceNode].outgoing[i];\n      adjacentList[destinationNode].incoming--;\n      if (adjacentList[destinationNode].incoming === 0) {\n        sourceNodes.push(destinationNode);\n      }\n      adjacentList[sourceNode].outgoing.splice(i, 1);\n      i--;\n    }\n    orderedNodes.push(sourceNode);\n  }\n  let hasEdges = false;\n  for (const node of Object.keys(adjacentList)) {\n    const edges = adjacentList[node];\n    if (edges.incoming !== 0) {\n      hasEdges = true;\n    }\n  }\n  if (hasEdges) {\n    return null;\n  } else {\n    return orderedNodes;\n  }\n}\n","import { FcModelValidationService } from './modelvalidation.service';\nimport {\n  FcConnector,\n  FcConnectorRectInfo,\n  FcCoords,\n  FcEdge,\n  FcItemInfo,\n  FcModel,\n  FcNode,\n  FcRectBox,\n  FlowchartConstants\n} from './ngx-flowchart.models';\nimport { Observable, of, Subject } from 'rxjs';\nimport { ChangeDetectorRef, EventEmitter } from '@angular/core';\nimport { debounceTime } from 'rxjs/operators';\n\nexport class FcModelService {\n\n  modelValidation: FcModelValidationService;\n  model: FcModel;\n  private readonly detectChangesSubject: Subject<any>;\n  selectedObjects: any[];\n\n  connectorsRectInfos: ConnectorRectInfoMap = {};\n  nodesHtmlElements: HtmlElementMap = {};\n  canvasHtmlElement: HTMLElement = null;\n  dragImage: HTMLImageElement = null;\n  svgHtmlElement: SVGElement = null;\n\n  dropNode: (event: Event, node: FcNode) => void;\n  createEdge: (event: Event, edge: FcEdge) => Observable<FcEdge>;\n  edgeAddedCallback: (edge: FcEdge) => void;\n  nodeRemovedCallback: (node: FcNode) => void;\n  edgeRemovedCallback: (edge: FcEdge) => void;\n\n  dropTargetId: string;\n\n  private readonly modelChanged: EventEmitter<any>;\n  private readonly debouncer = new Subject<any>();\n\n  connectors: ConnectorsModel;\n  nodes: NodesModel;\n  edges: EdgesModel;\n\n  constructor(modelValidation: FcModelValidationService,\n              model: FcModel,\n              modelChanged: EventEmitter<any>,\n              detectChangesSubject: Subject<any>,\n              selectedObjects: any[],\n              dropNode: (event: Event, node: FcNode) => void,\n              createEdge: (event: Event, edge: FcEdge) => Observable<FcEdge>,\n              edgeAddedCallback: (edge: FcEdge) => void,\n              nodeRemovedCallback: (node: FcNode) => void,\n              edgeRemovedCallback: (edge: FcEdge) => void,\n              canvasHtmlElement: HTMLElement,\n              svgHtmlElement: SVGElement) {\n\n    this.modelValidation = modelValidation;\n    this.model = model;\n    this.modelChanged = modelChanged;\n    this.detectChangesSubject = detectChangesSubject;\n    this.canvasHtmlElement = canvasHtmlElement;\n    this.svgHtmlElement = svgHtmlElement;\n    this.modelValidation.validateModel(this.model);\n    this.selectedObjects = selectedObjects;\n\n    this.dropNode = dropNode || (() => {});\n    this.createEdge = createEdge || ((event, edge) => of({...edge, label: 'label'}));\n    this.edgeAddedCallback = edgeAddedCallback || (() => {});\n    this.nodeRemovedCallback = nodeRemovedCallback || (() => {});\n    this.edgeRemovedCallback = edgeRemovedCallback || (() => {});\n\n    this.connectors = new ConnectorsModel(this);\n    this.nodes = new NodesModel(this);\n    this.edges = new EdgesModel(this);\n\n    this.debouncer\n      .pipe(debounceTime(100))\n      .subscribe(() => this.modelChanged.emit());\n  }\n\n  public notifyModelChanged() {\n    this.debouncer.next();\n  }\n\n  public detectChanges() {\n    setTimeout(() => {\n      this.detectChangesSubject.next();\n    }, 0);\n  }\n\n  public selectObject(object: any) {\n    if (this.isEditable()) {\n      if (this.selectedObjects.indexOf(object) === -1) {\n        this.selectedObjects.push(object);\n      }\n    }\n  }\n\n  public deselectObject(object: any) {\n    if (this.isEditable()) {\n      const index = this.selectedObjects.indexOf(object);\n      if (index === -1) {\n        throw new Error('Tried to deselect an unselected object');\n      }\n      this.selectedObjects.splice(index, 1);\n    }\n  }\n\n  public toggleSelectedObject(object: any) {\n    if (this.isSelectedObject(object)) {\n      this.deselectObject(object);\n    } else {\n      this.selectObject(object);\n    }\n  }\n\n  public isSelectedObject(object: any): boolean {\n    return this.selectedObjects.indexOf(object) !== -1;\n  }\n\n  public selectAll() {\n    this.model.nodes.forEach(node => {\n      if (!node.readonly) {\n        this.nodes.select(node);\n      }\n    });\n    this.model.edges.forEach(edge => {\n      this.edges.select(edge);\n    });\n    this.detectChanges();\n  }\n\n  public deselectAll() {\n    this.selectedObjects.splice(0, this.selectedObjects.length);\n    this.detectChanges();\n  }\n\n  public isEditObject(object: any): boolean {\n    return this.selectedObjects.length === 1 &&\n      this.selectedObjects.indexOf(object) !== -1;\n  }\n\n  private inRectBox(x: number, y: number, rectBox: FcRectBox): boolean {\n    return x >= rectBox.left && x <= rectBox.right &&\n      y >= rectBox.top && y <= rectBox.bottom;\n  }\n\n  public getItemInfoAtPoint(x: number, y: number): FcItemInfo {\n    return {\n      node: this.getNodeAtPoint(x, y),\n      edge: this.getEdgeAtPoint(x, y)\n    };\n  }\n\n  public getNodeAtPoint(x: number, y: number): FcNode {\n    for (const node of this.model.nodes) {\n      const element = this.nodes.getHtmlElement(node.id);\n      const nodeElementBox = element.getBoundingClientRect();\n      if (x >= nodeElementBox.left && x <= nodeElementBox.right\n        && y >= nodeElementBox.top && y <= nodeElementBox.bottom) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  public getEdgeAtPoint(x: number, y: number): FcEdge {\n    const element = document.elementFromPoint(x, y);\n    const id = element.id;\n    let edgeIndex = -1;\n    if (id) {\n      if (id.startsWith('fc-edge-path-')) {\n        edgeIndex = Number(id.substring('fc-edge-path-'.length));\n      } else if (id.startsWith('fc-edge-label-')) {\n        edgeIndex = Number(id.substring('fc-edge-label-'.length));\n      }\n    }\n    if (edgeIndex > -1) {\n      return this.model.edges[edgeIndex];\n    }\n    return null;\n  }\n\n  public selectAllInRect(rectBox: FcRectBox) {\n    this.model.nodes.forEach((value) => {\n      const element = this.nodes.getHtmlElement(value.id);\n      const nodeElementBox = element.getBoundingClientRect();\n      if (!value.readonly) {\n        const x = nodeElementBox.left + nodeElementBox.width / 2;\n        const y = nodeElementBox.top + nodeElementBox.height / 2;\n        if (this.inRectBox(x, y, rectBox)) {\n          this.nodes.select(value);\n        } else {\n          if (this.nodes.isSelected(value)) {\n            this.nodes.deselect(value);\n          }\n        }\n      }\n    });\n    const canvasElementBox = this.canvasHtmlElement.getBoundingClientRect();\n    this.model.edges.forEach((value) => {\n      const start = this.edges.sourceCoord(value);\n      const end = this.edges.destCoord(value);\n      const x = (start.x + end.x) / 2 + canvasElementBox.left;\n      const y = (start.y + end.y) / 2 + canvasElementBox.top;\n      if (this.inRectBox(x, y, rectBox)) {\n        this.edges.select(value);\n      } else {\n        if (this.edges.isSelected(value)) {\n          this.edges.deselect(value);\n        }\n      }\n    });\n  }\n\n  public deleteSelected() {\n    const edgesToDelete = this.edges.getSelectedEdges();\n    edgesToDelete.forEach((edge) => {\n      this.edges.delete(edge);\n    });\n    const nodesToDelete = this.nodes.getSelectedNodes();\n    nodesToDelete.forEach((node) => {\n      this.nodes.delete(node);\n    });\n  }\n\n  public isEditable(): boolean {\n    return this.dropTargetId === undefined;\n  }\n\n  public isDropSource(): boolean {\n    return this.dropTargetId !== undefined;\n  }\n\n  public getDragImage(): HTMLImageElement {\n    if (!this.dragImage) {\n      this.dragImage = new Image();\n      this.dragImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n      this.dragImage.style.visibility = 'hidden';\n    }\n    return this.dragImage;\n  }\n}\n\ninterface HtmlElementMap { [id: string]: HTMLElement; }\n\ninterface ConnectorRectInfoMap { [id: string]: FcConnectorRectInfo; }\n\nabstract class AbstractFcModel<T> {\n\n  modelService: FcModelService;\n\n  protected constructor(modelService: FcModelService) {\n    this.modelService = modelService;\n  }\n\n  public select(object: T) {\n    this.modelService.selectObject(object);\n  }\n\n  public deselect(object: T) {\n    this.modelService.deselectObject(object);\n  }\n\n  public toggleSelected(object: T) {\n    this.modelService.toggleSelectedObject(object);\n  }\n\n  public isSelected(object: T): boolean {\n    return this.modelService.isSelectedObject(object);\n  }\n\n  public isEdit(object: T): boolean {\n    return this.modelService.isEditObject(object);\n  }\n}\n\nclass ConnectorsModel extends AbstractFcModel<FcConnector> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public getConnector(connectorId: string): FcConnector {\n    const model = this.modelService.model;\n    for (const node of model.nodes) {\n      for (const connector of node.connectors) {\n        if (connector.id === connectorId) {\n          return connector;\n        }\n      }\n    }\n  }\n\n  public getConnectorRectInfo(connectorId: string): FcConnectorRectInfo {\n    return this.modelService.connectorsRectInfos[connectorId];\n  }\n\n  public setConnectorRectInfo(connectorId: string, connectorRectInfo: FcConnectorRectInfo) {\n    this.modelService.connectorsRectInfos[connectorId] = connectorRectInfo;\n    this.modelService.detectChanges();\n  }\n\n  private _getCoords(connectorId: string, centered?: boolean): FcCoords {\n    const connectorRectInfo = this.getConnectorRectInfo(connectorId);\n    const canvas = this.modelService.canvasHtmlElement;\n    if (connectorRectInfo === null || connectorRectInfo === undefined || canvas === null) {\n      return {x: 0, y: 0};\n    }\n    let x = connectorRectInfo.type === FlowchartConstants.leftConnectorType ?\n      connectorRectInfo.nodeRectInfo.left() : connectorRectInfo.nodeRectInfo.right();\n    let y = connectorRectInfo.nodeRectInfo.top() + connectorRectInfo.nodeRectInfo.height() / 2;\n    if (!centered) {\n      x -= connectorRectInfo.width / 2;\n      y -= connectorRectInfo.height / 2;\n    }\n    const coords: FcCoords = {\n      x: Math.round(x),\n      y: Math.round(y)\n    };\n    return coords;\n  }\n\n  public getCoords(connectorId: string): FcCoords {\n    return this._getCoords(connectorId, false);\n  }\n\n  public getCenteredCoord(connectorId: string): FcCoords {\n    return this._getCoords(connectorId, true);\n  }\n}\n\nclass NodesModel extends AbstractFcModel<FcNode> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public getConnectorsByType(node: FcNode, type: string): Array<FcConnector> {\n    return node.connectors.filter((connector) => {\n      return connector.type === type;\n    });\n  }\n\n  private _addConnector(node: FcNode, connector: FcConnector) {\n    node.connectors.push(connector);\n    try {\n      this.modelService.modelValidation.validateNode(node);\n    } catch (error) {\n      node.connectors.splice(node.connectors.indexOf(connector), 1);\n      throw error;\n    }\n  }\n\n  public delete(node: FcNode) {\n    if (this.isSelected(node)) {\n      this.deselect(node);\n    }\n    const model = this.modelService.model;\n    const index = model.nodes.indexOf(node);\n    if (index === -1) {\n      if (node === undefined) {\n        throw new Error('Passed undefined');\n      }\n      throw new Error('Tried to delete not existing node');\n    }\n    const connectorIds = this.getConnectorIds(node);\n    for (let i = 0; i < model.edges.length; i++) {\n      const edge = model.edges[i];\n      if (connectorIds.indexOf(edge.source) !== -1 || connectorIds.indexOf(edge.destination) !== -1) {\n        this.modelService.edges.delete(edge);\n        i--;\n      }\n    }\n    model.nodes.splice(index, 1);\n    this.modelService.notifyModelChanged();\n    this.modelService.nodeRemovedCallback(node);\n  }\n\n  public getSelectedNodes(): Array<FcNode> {\n    const model = this.modelService.model;\n    return model.nodes.filter((node) => {\n      return this.modelService.nodes.isSelected(node);\n    });\n  }\n\n  public handleClicked(node: FcNode, ctrlKey?: boolean) {\n    if (ctrlKey) {\n      this.modelService.nodes.toggleSelected(node);\n    } else {\n      this.modelService.deselectAll();\n      this.modelService.nodes.select(node);\n    }\n  }\n\n  private _addNode(node: FcNode) {\n    const model = this.modelService.model;\n    try {\n      model.nodes.push(node);\n      this.modelService.modelValidation.validateNodes(model.nodes);\n    } catch (error) {\n      model.nodes.splice(model.nodes.indexOf(node), 1);\n      throw error;\n    }\n  }\n\n  public getConnectorIds(node: FcNode): Array<string> {\n    return node.connectors.map((connector) => {\n      return connector.id;\n    });\n  }\n\n  public getNodeByConnectorId(connectorId: string): FcNode {\n    const model = this.modelService.model;\n    for (const node of model.nodes) {\n      const connectorIds = this.getConnectorIds(node);\n      if (connectorIds.indexOf(connectorId) > -1) {\n        return node;\n      }\n    }\n    return null;\n  }\n\n  public getHtmlElement(nodeId: string): HTMLElement {\n    return this.modelService.nodesHtmlElements[nodeId];\n  }\n\n  public setHtmlElement(nodeId: string, element: HTMLElement) {\n    this.modelService.nodesHtmlElements[nodeId] = element;\n    this.modelService.detectChanges();\n  }\n\n}\n\nclass EdgesModel extends AbstractFcModel<FcEdge> {\n\n  constructor(modelService: FcModelService) {\n    super(modelService);\n  }\n\n  public sourceCoord(edge: FcEdge): FcCoords {\n    return this.modelService.connectors.getCenteredCoord(edge.source);\n  }\n\n  public destCoord(edge: FcEdge): FcCoords {\n    return this.modelService.connectors.getCenteredCoord(edge.destination);\n  }\n\n  public delete(edge: FcEdge) {\n    const model = this.modelService.model;\n    const index = model.edges.indexOf(edge);\n    if (index === -1) {\n      throw new Error('Tried to delete not existing edge');\n    }\n    if (this.isSelected(edge)) {\n      this.deselect(edge);\n    }\n    model.edges.splice(index, 1);\n    this.modelService.notifyModelChanged();\n    this.modelService.edgeRemovedCallback(edge);\n  }\n\n  public getSelectedEdges(): Array<FcEdge> {\n    const model = this.modelService.model;\n    return model.edges.filter((edge) => {\n      return this.modelService.edges.isSelected(edge);\n    });\n  }\n\n  public handleEdgeMouseClick(edge: FcEdge, ctrlKey?: boolean) {\n    if (ctrlKey) {\n      this.modelService.edges.toggleSelected(edge);\n    } else {\n      this.modelService.deselectAll();\n      this.modelService.edges.select(edge);\n    }\n  }\n\n  public putEdge(edge: FcEdge) {\n    const model = this.modelService.model;\n    model.edges.push(edge);\n    this.modelService.notifyModelChanged();\n  }\n\n  public _addEdge(event: Event, sourceConnector: FcConnector, destConnector: FcConnector, label: string) {\n    this.modelService.modelValidation.validateConnector(sourceConnector);\n    this.modelService.modelValidation.validateConnector(destConnector);\n    const edge: FcEdge = {};\n    edge.source = sourceConnector.id;\n    edge.destination = destConnector.id;\n    edge.label = label;\n    const model = this.modelService.model;\n    this.modelService.modelValidation.validateEdges(model.edges.concat([edge]), model.nodes);\n    this.modelService.createEdge(event, edge).subscribe(\n      (created) => {\n        model.edges.push(created);\n        this.modelService.notifyModelChanged();\n        this.modelService.edgeAddedCallback(created);\n      }\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { FcConnector, FcEdge, FcModel, FcNode, fcTopSort, ModelvalidationError } from './ngx-flowchart.models';\n\n@Injectable()\nexport class FcModelValidationService {\n\n  constructor() { }\n\n  public validateModel(model: FcModel): FcModel {\n    this.validateNodes(model.nodes);\n    this._validateEdges(model.edges, model.nodes);\n    return model;\n  }\n\n  public validateNodes(nodes: Array<FcNode>): Array<FcNode> {\n    const ids: string[] = [];\n    nodes.forEach((node) => {\n      this.validateNode(node);\n      if (ids.indexOf(node.id) !== -1) {\n        throw new ModelvalidationError('Id not unique.');\n      }\n      ids.push(node.id);\n    });\n    const connectorIds: string[] = [];\n    nodes.forEach((node) => {\n      node.connectors.forEach((connector) => {\n        if (connectorIds.indexOf(connector.id) !== -1) {\n          throw new ModelvalidationError('Id not unique.');\n        }\n        connectorIds.push(connector.id);\n      });\n    });\n    return nodes;\n  }\n\n  public validateNode(node: FcNode): FcNode {\n    if (node.id === undefined) {\n      throw new ModelvalidationError('Id not valid.');\n    }\n    if (typeof node.name !== 'string') {\n      throw new ModelvalidationError('Name not valid.');\n    }\n    if (typeof node.x !== 'number' || node.x < 0 || Math.round(node.x) !== node.x) {\n      throw new ModelvalidationError('Coordinates not valid.');\n    }\n    if (typeof node.y !== 'number' || node.y < 0 || Math.round(node.y) !== node.y) {\n      throw new ModelvalidationError('Coordinates not valid.');\n    }\n    if (!Array.isArray(node.connectors)) {\n      throw new ModelvalidationError('Connectors not valid.');\n    }\n    node.connectors.forEach((connector) => {\n      this.validateConnector(connector);\n    });\n    return node;\n  }\n\n  private _validateEdges(edges: Array<FcEdge>, nodes: Array<FcNode>): Array<FcEdge> {\n    edges.forEach((edge) => {\n      this._validateEdge(edge, nodes);\n    });\n    edges.forEach((edge1, index1) => {\n      edges.forEach((edge2, index2) => {\n        if (index1 !== index2) {\n          if ((edge1.source === edge2.source && edge1.destination === edge2.destination) ||\n            (edge1.source === edge2.destination && edge1.destination === edge2.source)) {\n            throw new ModelvalidationError('Duplicated edge.');\n          }\n        }\n      });\n    });\n    if (fcTopSort({nodes, edges}) === null) {\n      throw new ModelvalidationError('Graph has a circle.');\n    }\n    return edges;\n  }\n\n  public validateEdges(edges: Array<FcEdge>, nodes: Array<FcNode>): Array<FcEdge> {\n    this.validateNodes(nodes);\n    return this._validateEdges(edges, nodes);\n  }\n\n  private _validateEdge(edge: FcEdge, nodes: Array<FcNode>): FcEdge {\n    if (edge.source === undefined) {\n      throw new ModelvalidationError('Source not valid.');\n    }\n    if (edge.destination === undefined) {\n      throw new ModelvalidationError('Destination not valid.');\n    }\n    if (edge.source === edge.destination) {\n      throw new ModelvalidationError('Edge with same source and destination connectors.');\n    }\n    const sourceNode = nodes.filter((node) => node.connectors.some((connector) => connector.id === edge.source))[0];\n    if (sourceNode === undefined) {\n      throw new ModelvalidationError('Source not valid.');\n    }\n    const destinationNode = nodes.filter((node) => node.connectors.some((connector) => connector.id === edge.destination))[0];\n    if (destinationNode === undefined) {\n      throw new ModelvalidationError('Destination not valid.');\n    }\n    if (sourceNode === destinationNode) {\n      throw new ModelvalidationError('Edge with same source and destination nodes.');\n    }\n    return edge;\n  }\n\n  public validateEdge(edge: FcEdge, nodes: Array<FcNode>): FcEdge {\n    this.validateNodes(nodes);\n    return this._validateEdge(edge, nodes);\n  }\n\n  public validateConnector(connector: FcConnector): FcConnector {\n    if (connector.id === undefined) {\n      throw new ModelvalidationError('Id not valid.');\n    }\n    if (connector.type === undefined || connector.type === null || typeof connector.type !== 'string') {\n      throw new ModelvalidationError('Type not valid.');\n    }\n    return connector;\n  }\n\n}\n","import { FcModelService } from './model.service';\nimport { FcCoords, FcNode, FlowchartConstants } from './ngx-flowchart.models';\n\nconst nodeDropScope: NodeDropScope = {\n  dropElement: null\n};\n\nexport class FcNodeDraggingService {\n\n  nodeDraggingScope: NodeDraggingScope = {\n    shadowDragStarted: false,\n    dropElement: null,\n    draggedNodes: [],\n    shadowElements: []\n  };\n\n  private dragOffsets: FcCoords[] = [];\n  private draggedElements: HTMLElement[] = [];\n\n  private destinationHtmlElements: HTMLElement[] = [];\n  private oldDisplayStyles: string[] = [];\n\n  private readonly modelService: FcModelService;\n  private readonly automaticResize: boolean;\n  private readonly dragAnimation: string;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(modelService: FcModelService,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T,\n              automaticResize: boolean, dragAnimation: string) {\n    this.modelService = modelService;\n    this.automaticResize = automaticResize;\n    this.dragAnimation = dragAnimation;\n    this.applyFunction = applyFunction;\n  }\n\n  private getCoordinate(coordinate: number, max: number): number {\n    coordinate = Math.max(coordinate, 0);\n    coordinate = Math.min(coordinate, max);\n    return coordinate;\n  }\n\n  private getXCoordinate(x: number): number {\n    return this.getCoordinate(x, this.modelService.canvasHtmlElement.offsetWidth);\n  }\n\n  private getYCoordinate(y: number): number {\n    return this.getCoordinate(y, this.modelService.canvasHtmlElement.offsetHeight);\n  }\n\n  private resizeCanvas(draggedNode: FcNode, nodeElement: HTMLElement) {\n    if (this.automaticResize && !this.modelService.isDropSource()) {\n      const canvasElement = this.modelService.canvasHtmlElement;\n      if (canvasElement.offsetWidth < draggedNode.x + nodeElement.offsetWidth + FlowchartConstants.canvasResizeThreshold) {\n        canvasElement.style.width = canvasElement.offsetWidth + FlowchartConstants.canvasResizeStep + 'px';\n      }\n      if (canvasElement.offsetHeight < draggedNode.y + nodeElement.offsetHeight + FlowchartConstants.canvasResizeThreshold) {\n        canvasElement.style.height = canvasElement.offsetHeight + FlowchartConstants.canvasResizeStep + 'px';\n      }\n    }\n  }\n\n  public isDraggingNode(node: FcNode): boolean {\n    return this.nodeDraggingScope.draggedNodes.includes(node);\n  }\n\n  public dragstart(event: DragEvent, node: FcNode) {\n    if (node.readonly) {\n      return;\n    }\n    this.dragOffsets.length = 0;\n    this.draggedElements.length = 0;\n    this.nodeDraggingScope.draggedNodes.length = 0;\n    this.nodeDraggingScope.shadowElements.length = 0;\n    this.destinationHtmlElements.length = 0;\n    this.oldDisplayStyles.length = 0;\n    const elements: Array<JQuery<HTMLElement>> = [];\n    const nodes: Array<FcNode> = [];\n    if (this.modelService.nodes.isSelected(node)) {\n      const selectedNodes = this.modelService.nodes.getSelectedNodes();\n      for (const selectedNode of selectedNodes) {\n        const element = $(this.modelService.nodes.getHtmlElement(selectedNode.id));\n        elements.push(element);\n        nodes.push(selectedNode);\n      }\n    } else {\n      elements.push($(event.target as HTMLElement));\n      nodes.push(node);\n    }\n    const offsetsX: number[] = [];\n    const offsetsY: number[] = [];\n    for (const element of elements) {\n      offsetsX.push(parseInt(element.css('left'), 10) - event.clientX);\n      offsetsY.push(parseInt(element.css('top'), 10) - event.clientY);\n    }\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n    if (this.modelService.isDropSource()) {\n      if (nodeDropScope.dropElement) {\n        nodeDropScope.dropElement.parentNode.removeChild(nodeDropScope.dropElement);\n        nodeDropScope.dropElement = null;\n      }\n      nodeDropScope.dropElement = elements[0][0].cloneNode(true) as NodeDropElement;\n      const offset = $(this.modelService.canvasHtmlElement).offset();\n      nodeDropScope.dropElement.offsetInfo = {\n        offsetX: Math.round(offsetsX[0] + offset.left),\n        offsetY: Math.round(offsetsY[0] + offset.top)\n      };\n      nodeDropScope.dropElement.style.position = 'absolute';\n      nodeDropScope.dropElement.style.pointerEvents = 'none';\n      nodeDropScope.dropElement.style.zIndex = '9999';\n\n      document.body.appendChild(nodeDropScope.dropElement);\n      const dropNodeInfo: DropNodeInfo = {\n        node,\n        dropTargetId: this.modelService.dropTargetId,\n        offsetX: Math.round(offsetsX[0] + offset.left),\n        offsetY: Math.round(offsetsY[0] + offset.top)\n      };\n      originalEvent.dataTransfer.setData('text', JSON.stringify(dropNodeInfo));\n\n      if (originalEvent.dataTransfer.setDragImage) {\n        originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n      } else {\n        const target: HTMLElement = event.target as HTMLElement;\n        const cloneNode = target.cloneNode(true);\n        target.parentNode.insertBefore(cloneNode, target);\n        target.style.visibility = 'collapse';\n        setTimeout(() => {\n          target.parentNode.removeChild(cloneNode);\n          target.style.visibility = 'visible';\n        }, 0);\n      }\n      return;\n    }\n    this.nodeDraggingScope.draggedNodes = nodes;\n    for (let i = 0; i < elements.length; i++) {\n      this.draggedElements.push(elements[i][0]);\n      this.dragOffsets.push(\n        {\n          x: offsetsX[i],\n          y: offsetsY[i]\n        }\n      );\n    }\n\n    if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      for (let i = 0; i < this.draggedElements.length; i++) {\n        const dragOffset = this.dragOffsets[i];\n        const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n        const shadowElement = $(`<div style=\"position: absolute; opacity: 0.7; ` +\n                                `top: ${this.getYCoordinate(dragOffset.y + event.clientY)}px; ` +\n                                `left: ${this.getXCoordinate(dragOffset.x + event.clientX)}px; \">` +\n                                `<div class=\"innerNode\"><p style=\"padding: 0 15px;\">${draggedNode.name}</p> </div></div>`);\n        const targetInnerNode = $(this.draggedElements[i]).children()[0];\n        shadowElement.children()[0].style.backgroundColor = targetInnerNode.style.backgroundColor;\n        this.nodeDraggingScope.shadowElements.push(shadowElement);\n        this.modelService.canvasHtmlElement.appendChild(this.nodeDraggingScope.shadowElements[i][0]);\n      }\n    }\n    originalEvent.dataTransfer.setData('text', 'Just to support firefox');\n    if (originalEvent.dataTransfer.setDragImage) {\n      originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n    } else {\n      this.draggedElements.forEach((draggedElement) => {\n        const cloneNode = draggedElement.cloneNode(true);\n        draggedElement.parentNode.insertBefore(cloneNode, draggedElement);\n        draggedElement.style.visibility = 'collapse';\n        setTimeout(() => {\n          draggedElement.parentNode.removeChild(cloneNode);\n          draggedElement.style.visibility = 'visible';\n        }, 0);\n      });\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        for (let i = 0; i < this.draggedElements.length; i++) {\n          this.destinationHtmlElements.push(this.draggedElements[i]);\n          this.oldDisplayStyles.push(this.destinationHtmlElements[i].style.display);\n          this.destinationHtmlElements[i].style.display = 'none';\n        }\n        this.nodeDraggingScope.shadowDragStarted = true;\n      }\n    }\n  }\n\n  public drop(event: DragEvent): boolean {\n    if (this.modelService.isDropSource()) {\n      event.preventDefault();\n      return false;\n    }\n    let dropNode: FcNode = null;\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n    const infoText = originalEvent.dataTransfer.getData('text');\n    if (infoText) {\n      let dropNodeInfo: DropNodeInfo = null;\n      try {\n        dropNodeInfo = JSON.parse(infoText);\n      } catch (e) {}\n      if (dropNodeInfo && dropNodeInfo.dropTargetId) {\n        if (this.modelService.canvasHtmlElement.id &&\n          this.modelService.canvasHtmlElement.id === dropNodeInfo.dropTargetId) {\n          dropNode = dropNodeInfo.node;\n          const offset = $(this.modelService.canvasHtmlElement).offset();\n          const x = event.clientX - offset.left;\n          const y = event.clientY - offset.top;\n          dropNode.x = Math.round(this.getXCoordinate(dropNodeInfo.offsetX + x));\n          dropNode.y = Math.round(this.getYCoordinate(dropNodeInfo.offsetY + y));\n        }\n      }\n    }\n    if (dropNode) {\n      this.modelService.dropNode(event, dropNode);\n      event.preventDefault();\n      return false;\n    } else if (this.nodeDraggingScope.draggedNodes.length) {\n      return this.applyFunction(() => {\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const dragOffset = this.dragOffsets[i];\n          draggedNode.x = Math.round(this.getXCoordinate(dragOffset.x + event.clientX));\n          draggedNode.y = Math.round(this.getYCoordinate(dragOffset.y + event.clientY));\n        }\n        event.preventDefault();\n        this.modelService.notifyModelChanged();\n        return false;\n      });\n    }\n  }\n\n  public dragover(event: DragEvent) {\n    if (nodeDropScope.dropElement) {\n      const offsetInfo = nodeDropScope.dropElement.offsetInfo;\n      nodeDropScope.dropElement.style.left = (offsetInfo.offsetX + event.clientX) + 'px';\n      nodeDropScope.dropElement.style.top = (offsetInfo.offsetY + event.clientY) + 'px';\n      if (this.nodeDraggingScope.shadowDragStarted) {\n        this.applyFunction(() => {\n          this.destinationHtmlElements[0].style.display = this.oldDisplayStyles[0];\n          this.nodeDraggingScope.shadowDragStarted = false;\n        });\n      }\n      event.preventDefault();\n      return;\n    }\n    if (this.modelService.isDropSource()) {\n      event.preventDefault();\n      return;\n    }\n    if (!this.nodeDraggingScope.draggedNodes.length) {\n      event.preventDefault();\n      return;\n    }\n    if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        return this.applyFunction(() => {\n          for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n            const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n            const dragOffset = this.dragOffsets[i];\n            draggedNode.x = this.getXCoordinate(dragOffset.x + event.clientX);\n            draggedNode.y = this.getYCoordinate(dragOffset.y + event.clientY);\n            this.resizeCanvas(draggedNode, this.draggedElements[i]);\n          }\n          event.preventDefault();\n          this.modelService.notifyModelChanged();\n          return false;\n        });\n      }\n    } else if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        if (this.nodeDraggingScope.shadowDragStarted) {\n          this.applyFunction(() => {\n            for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n              this.destinationHtmlElements[i].style.display = this.oldDisplayStyles[i];\n            }\n            this.nodeDraggingScope.shadowDragStarted = false;\n          });\n        }\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const dragOffset = this.dragOffsets[i];\n          this.nodeDraggingScope.shadowElements[i].css('left', this.getXCoordinate(dragOffset.x + event.clientX) + 'px');\n          this.nodeDraggingScope.shadowElements[i].css('top', this.getYCoordinate(dragOffset.y + event.clientY) + 'px');\n          this.resizeCanvas(draggedNode, this.draggedElements[i]);\n        }\n        event.preventDefault();\n      }\n    }\n  }\n\n  public dragend(event: DragEvent) {\n    this.applyFunction(() => {\n      if (nodeDropScope.dropElement) {\n        nodeDropScope.dropElement.parentNode.removeChild(nodeDropScope.dropElement);\n        nodeDropScope.dropElement = null;\n      }\n      if (this.modelService.isDropSource()) {\n        return;\n      }\n      if (this.nodeDraggingScope.shadowElements.length) {\n        for (let i = 0; i < this.nodeDraggingScope.draggedNodes.length; i++) {\n          const draggedNode = this.nodeDraggingScope.draggedNodes[i];\n          const shadowElement = this.nodeDraggingScope.shadowElements[i];\n          draggedNode.x = parseInt(shadowElement.css('left').replace('px', ''), 10);\n          draggedNode.y = parseInt(shadowElement.css('top').replace('px', ''), 10);\n          this.modelService.canvasHtmlElement.removeChild(shadowElement[0]);\n        }\n        this.nodeDraggingScope.shadowElements.length = 0;\n        this.modelService.notifyModelChanged();\n      }\n\n      if (this.nodeDraggingScope.draggedNodes.length) {\n        this.nodeDraggingScope.draggedNodes.length = 0;\n        this.draggedElements.length = 0;\n        this.dragOffsets.length = 0;\n      }\n    });\n  }\n\n}\n\nexport interface NodeDraggingScope {\n  draggedNodes: Array<FcNode>;\n  shadowElements: Array<JQuery<HTMLElement>>;\n  shadowDragStarted: boolean;\n  dropElement: HTMLElement;\n}\n\nexport interface NodeDropElement extends HTMLElement {\n  offsetInfo?: {\n    offsetX: number;\n    offsetY: number;\n  };\n}\n\nexport interface NodeDropScope {\n  dropElement: NodeDropElement;\n}\n\nexport interface DropNodeInfo {\n  node: FcNode;\n  dropTargetId: string;\n  offsetX: number;\n  offsetY: number;\n}\n","import { Injectable } from '@angular/core';\nimport { FcCoords, FlowchartConstants } from './ngx-flowchart.models';\n\n@Injectable()\nexport class FcEdgeDrawingService {\n\n  constructor() {\n  }\n\n  public getEdgeDAttribute(pt1: FcCoords, pt2: FcCoords, style: string): string {\n    let dAddribute = `M ${pt1.x}, ${pt1.y} `;\n    if (style === FlowchartConstants.curvedStyle) {\n      const sourceTangent = this.computeEdgeSourceTangent(pt1, pt2);\n      const destinationTangent = this.computeEdgeDestinationTangent(pt1, pt2);\n      dAddribute += `C ${sourceTangent.x}, ${sourceTangent.y} ${(destinationTangent.x - 50)}, ${destinationTangent.y} ${pt2.x}, ${pt2.y}`;\n    } else {\n      dAddribute += `L ${pt2.x}, ${pt2.y}`;\n    }\n    return dAddribute;\n  }\n\n  public getEdgeCenter(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: (pt1.x + pt2.x) / 2,\n      y: (pt1.y + pt2.y) / 2\n    };\n  }\n\n  private computeEdgeTangentOffset(pt1: FcCoords, pt2: FcCoords): number {\n    return (pt2.y - pt1.y) / 2;\n  }\n\n  private computeEdgeSourceTangent(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: pt1.x,\n      y: pt1.y + this.computeEdgeTangentOffset(pt1, pt2)\n    };\n  }\n\n  private computeEdgeDestinationTangent(pt1: FcCoords, pt2: FcCoords): FcCoords {\n    return {\n      x: pt2.x,\n      y: pt2.y - this.computeEdgeTangentOffset(pt1, pt2)\n    };\n  }\n\n}\n","import { FcModelService } from './model.service';\nimport { FcConnector, FcCoords, FcEdge, FcModel, FlowchartConstants, ModelvalidationError } from './ngx-flowchart.models';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { FcModelValidationService } from './modelvalidation.service';\n\nexport class FcEdgeDraggingService {\n\n  edgeDragging: EdgeDragging = {\n    isDragging: false,\n    dragPoint1: null,\n    dragPoint2: null,\n    shadowDragStarted: false\n  };\n\n  private draggedEdgeSource: FcConnector = null;\n  private dragOffset: FcCoords = {};\n  private destinationHtmlElement: HTMLElement = null;\n  private oldDisplayStyle = '';\n\n  private readonly modelValidation: FcModelValidationService;\n  private readonly edgeDrawingService: FcEdgeDrawingService;\n  private readonly modelService: FcModelService;\n  private readonly model: FcModel;\n  private readonly isValidEdgeCallback: (source: FcConnector, destination: FcConnector) => boolean;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n  private readonly dragAnimation: string;\n  private readonly edgeStyle: string;\n\n  constructor(modelValidation: FcModelValidationService,\n              edgeDrawingService: FcEdgeDrawingService,\n              modelService: FcModelService,\n              model: FcModel,\n              isValidEdgeCallback: (source: FcConnector, destination: FcConnector) => boolean,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T,\n              dragAnimation: string,\n              edgeStyle: string) {\n    this.modelValidation = modelValidation;\n    this.edgeDrawingService = edgeDrawingService;\n    this.modelService = modelService;\n    this.model = model;\n    this.isValidEdgeCallback = isValidEdgeCallback || (() => true);\n    this.applyFunction = applyFunction;\n    this.dragAnimation = dragAnimation;\n    this.edgeStyle = edgeStyle;\n  }\n\n  public dragstart(event: DragEvent, connector: FcConnector) {\n    let swapConnector: FcConnector;\n    let dragLabel: string;\n    let prevEdge: FcEdge;\n    if (connector.type === FlowchartConstants.leftConnectorType) {\n      for (const edge of this.model.edges) {\n        if (edge.destination === connector.id) {\n          swapConnector = this.modelService.connectors.getConnector(edge.source);\n          dragLabel = edge.label;\n          prevEdge = edge;\n          this.applyFunction(() => {\n            this.modelService.edges.delete(edge);\n          });\n          break;\n        }\n      }\n    }\n    this.edgeDragging.isDragging = true;\n    if (swapConnector !== undefined) {\n      this.draggedEdgeSource = swapConnector;\n      this.edgeDragging.dragPoint1 = this.modelService.connectors.getCenteredCoord(swapConnector.id);\n      this.edgeDragging.dragLabel = dragLabel;\n      this.edgeDragging.prevEdge = prevEdge;\n    } else {\n      this.draggedEdgeSource = connector;\n      this.edgeDragging.dragPoint1 = this.modelService.connectors.getCenteredCoord(connector.id);\n    }\n    const canvas = this.modelService.canvasHtmlElement;\n    if (!canvas) {\n      throw new Error('No canvas while edgedraggingService found.');\n    }\n    this.dragOffset.x = -canvas.getBoundingClientRect().left;\n    this.dragOffset.y = -canvas.getBoundingClientRect().top;\n\n    this.edgeDragging.dragPoint2 = {\n      x: event.clientX + this.dragOffset.x,\n      y: event.clientY + this.dragOffset.y\n    };\n    const originalEvent: DragEvent = (event as any).originalEvent || event;\n\n    originalEvent.dataTransfer.setData('Text', 'Just to support firefox');\n    if (originalEvent.dataTransfer.setDragImage) {\n      originalEvent.dataTransfer.setDragImage(this.modelService.getDragImage(), 0, 0);\n    } else {\n      this.destinationHtmlElement = event.target as HTMLElement;\n      this.oldDisplayStyle = this.destinationHtmlElement.style.display;\n      this.destinationHtmlElement.style.display = 'none';\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        this.edgeDragging.shadowDragStarted = true;\n      }\n    }\n    if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n      if (this.edgeDragging.gElement === undefined) {\n        this.edgeDragging.gElement = $(document.querySelectorAll('.shadow-svg-class'));\n        this.edgeDragging.pathElement = $(document.querySelectorAll('.shadow-svg-class')).find('path');\n        this.edgeDragging.circleElement = $(document.querySelectorAll('.shadow-svg-class')).find('circle');\n      }\n\n      this.edgeDragging.gElement.css('display', 'block');\n      this.edgeDragging.pathElement.attr('d',\n        this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n      this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n      this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n    }\n    event.stopPropagation();\n  }\n\n  public dragover(event: DragEvent) {\n    if (this.edgeDragging.isDragging) {\n      if (!this.edgeDragging.magnetActive && this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        if (this.destinationHtmlElement !== null) {\n          this.destinationHtmlElement.style.display = this.oldDisplayStyle;\n        }\n\n        if (this.edgeDragging.shadowDragStarted) {\n          this.applyFunction(() => {\n            this.edgeDragging.shadowDragStarted = false;\n          });\n        }\n\n        this.edgeDragging.dragPoint2 = {\n          x: event.clientX + this.dragOffset.x,\n          y: event.clientY + this.dragOffset.y\n        };\n\n        this.edgeDragging.pathElement.attr('d',\n          this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n        this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n        this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n\n      } else if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n        return this.applyFunction(() => {\n          if (this.destinationHtmlElement !== null) {\n            this.destinationHtmlElement.style.display = this.oldDisplayStyle;\n          }\n\n          this.edgeDragging.dragPoint2 = {\n            x: event.clientX + this.dragOffset.x,\n            y: event.clientY + this.dragOffset.y\n          };\n        });\n      }\n    }\n  }\n\n  public dragoverConnector(event: DragEvent, connector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      this.dragover(event);\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: connector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, connector)) {\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n      }\n    }\n  }\n\n  public dragleaveMagnet(event: DragEvent) {\n    this.edgeDragging.magnetActive = false;\n  }\n\n  public dragoverMagnet(event: DragEvent, connector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      this.dragover(event);\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: connector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, connector)) {\n        if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n\n          this.edgeDragging.magnetActive = true;\n\n          this.edgeDragging.dragPoint2 = this.modelService.connectors.getCenteredCoord(connector.id);\n          this.edgeDragging.pathElement.attr('d',\n            this.edgeDrawingService.getEdgeDAttribute(this.edgeDragging.dragPoint1, this.edgeDragging.dragPoint2, this.edgeStyle));\n          this.edgeDragging.circleElement.attr('cx', this.edgeDragging.dragPoint2.x);\n          this.edgeDragging.circleElement.attr('cy', this.edgeDragging.dragPoint2.y);\n\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        } else if (this.dragAnimation === FlowchartConstants.dragAnimationRepaint) {\n          return this.applyFunction(() => {\n            this.edgeDragging.dragPoint2 = this.modelService.connectors.getCenteredCoord(connector.id);\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n          });\n        }\n      }\n    }\n  }\n\n  public dragend(event: DragEvent) {\n    if (this.edgeDragging.isDragging) {\n      this.edgeDragging.isDragging = false;\n      this.edgeDragging.dragPoint1 = null;\n      this.edgeDragging.dragPoint2 = null;\n      this.edgeDragging.dragLabel = null;\n      event.stopPropagation();\n\n      if (this.dragAnimation === FlowchartConstants.dragAnimationShadow) {\n        this.edgeDragging.gElement.css('display', 'none');\n      }\n      if (this.edgeDragging.prevEdge) {\n        const edge = this.edgeDragging.prevEdge;\n        this.edgeDragging.prevEdge = null;\n        this.applyFunction(() => {\n          this.modelService.edges.putEdge(edge);\n        });\n      }\n    }\n  }\n\n  public drop(event: DragEvent, targetConnector: FcConnector): boolean {\n    if (this.edgeDragging.isDragging) {\n      try {\n        this.modelValidation.validateEdges(this.model.edges.concat([{\n          source: this.draggedEdgeSource.id,\n          destination: targetConnector.id\n        }]), this.model.nodes);\n      } catch (error) {\n        if (error instanceof ModelvalidationError) {\n          return true;\n        } else {\n          throw error;\n        }\n      }\n\n      if (this.isValidEdgeCallback(this.draggedEdgeSource, targetConnector)) {\n        this.edgeDragging.prevEdge = null;\n        this.modelService.edges._addEdge(event, this.draggedEdgeSource, targetConnector, this.edgeDragging.dragLabel);\n        event.stopPropagation();\n        event.preventDefault();\n        return false;\n      }\n    }\n  }\n}\n\nexport interface EdgeDragging {\n  isDragging: boolean;\n  shadowDragStarted: boolean;\n  dragPoint1: FcCoords;\n  dragPoint2: FcCoords;\n  dragLabel?: string;\n  prevEdge?: FcEdge;\n  magnetActive?: boolean;\n  gElement?: JQuery<Element>;\n  pathElement?: JQuery<Element>;\n  circleElement?: JQuery<Element>;\n}\n","import { FcConnector, FcEdge, FcNode } from './ngx-flowchart.models';\n\nexport class FcMouseOverService {\n\n  mouseoverscope: MouseOverScope = {\n    connector: null,\n    edge: null,\n    node: null\n  };\n\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(applyFunction: <T>(fn: (...args: any[]) => T) => T) {\n    this.applyFunction = applyFunction;\n  }\n\n  public nodeMouseOver(event: MouseEvent, node: FcNode) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.node = node;\n    });\n  }\n\n  public nodeMouseOut(event: MouseEvent, node: FcNode) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.node = null;\n    });\n  }\n\n  public connectorMouseEnter(event: MouseEvent, connector: FcConnector) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.connector = connector;\n    });\n  }\n\n  public connectorMouseLeave(event: MouseEvent, connector: FcConnector) {\n    return this.applyFunction(() => {\n      this.mouseoverscope.connector = null;\n    });\n  }\n\n  public edgeMouseEnter(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverscope.edge = edge;\n  }\n\n  public edgeMouseLeave(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverscope.edge = null;\n  }\n}\n\nexport interface MouseOverScope {\n  connector: FcConnector;\n  edge: FcEdge;\n  node: FcNode;\n}\n","const regex = /(auto|scroll)/;\n\nconst style = (node: Element, prop: string): string =>\n  getComputedStyle(node, null).getPropertyValue(prop);\n\nconst scroll = (node: Element) =>\n  regex.test(\n    style(node, 'overflow') +\n    style(node, 'overflow-y') +\n    style(node, 'overflow-x'));\n\nconst scrollparent = (node: HTMLElement): HTMLElement =>\n  !node || node === document.body\n    ? document.body\n    : scroll(node)\n    ? node\n    : scrollparent(node.parentNode as HTMLElement);\n\nexport default scrollparent;\n","import { FcModelService } from './model.service';\nimport { FcRectBox } from './ngx-flowchart.models';\nimport scrollparent from './scrollparent';\n\ninterface Rectangle {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nexport class FcRectangleSelectService {\n\n  private readonly selectRect: Rectangle = {\n    x1: 0,\n    x2: 0,\n    y1: 0,\n    y2: 0\n  };\n\n  private readonly modelService: FcModelService;\n  private readonly selectElement: HTMLElement;\n  private readonly $canvasElement: JQuery<HTMLElement>;\n  private readonly $scrollParent: JQuery<HTMLElement>;\n  private readonly applyFunction: <T>(fn: (...args: any[]) => T) => T;\n\n  constructor(modelService: FcModelService,\n              selectElement: HTMLElement,\n              applyFunction: <T>(fn: (...args: any[]) => T) => T) {\n    this.modelService = modelService;\n    this.selectElement = selectElement;\n    this.$canvasElement = $(this.modelService.canvasHtmlElement);\n    this.$scrollParent = $(scrollparent(this.modelService.canvasHtmlElement));\n    this.applyFunction = applyFunction;\n  }\n\n  public mousedown(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && this.selectElement.hidden) {\n      this.selectElement.hidden = false;\n      const offset = this.$canvasElement.offset();\n      this.selectRect.x1 = Math.round(e.pageX - offset.left);\n      this.selectRect.y1 = Math.round(e.pageY - offset.top);\n      this.selectRect.x2 = this.selectRect.x1;\n      this.selectRect.y2 = this.selectRect.y1;\n      this.updateSelectRect();\n    }\n  }\n\n  public mousemove(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && !this.selectElement.hidden) {\n      const offset = this.$canvasElement.offset();\n      this.selectRect.x2 = Math.round(e.pageX - offset.left);\n      this.selectRect.y2 = Math.round(e.pageY - offset.top);\n      this.updateScroll(offset);\n      this.updateSelectRect();\n    }\n  }\n\n  private updateScroll(offset: JQuery.Coordinates) {\n    const rect = this.$scrollParent[0].getBoundingClientRect();\n    const bottom = rect.bottom - offset.top;\n    const right = rect.right - offset.left;\n    const top = rect.top - offset.top;\n    const left = rect.left - offset.left;\n    if (this.selectRect.y2 - top < 25) {\n      const topScroll = 25 - (this.selectRect.y2 - top);\n      const scroll = this.$scrollParent.scrollTop();\n      this.$scrollParent.scrollTop(scroll - topScroll);\n    } else if (bottom - this.selectRect.y2 < 40) {\n      const bottomScroll = 40 - (bottom - this.selectRect.y2);\n      const scroll = this.$scrollParent.scrollTop();\n      this.$scrollParent.scrollTop(scroll + bottomScroll);\n    }\n    if (this.selectRect.x2 - left < 25) {\n      const leftScroll = 25 - (this.selectRect.x2 - left);\n      const scroll = this.$scrollParent.scrollLeft();\n      this.$scrollParent.scrollLeft(scroll - leftScroll);\n    } else if (right - this.selectRect.x2 < 40) {\n      const rightScroll = 40 - (right - this.selectRect.x2);\n      const scroll = this.$scrollParent.scrollLeft();\n      this.$scrollParent.scrollLeft(scroll + rightScroll);\n    }\n  }\n\n  public mouseup(e: MouseEvent) {\n    if (this.modelService.isEditable() && !e.ctrlKey && !e.metaKey && e.button === 0\n      && !this.selectElement.hidden) {\n      const rectBox = this.selectElement.getBoundingClientRect() as FcRectBox;\n      this.selectElement.hidden = true;\n      this.selectObjects(rectBox);\n    }\n  }\n\n  private updateSelectRect() {\n    const x3 = Math.min(this.selectRect.x1, this.selectRect.x2);\n    const x4 = Math.max(this.selectRect.x1, this.selectRect.x2);\n    const y3 = Math.min(this.selectRect.y1, this.selectRect.y2);\n    const y4 = Math.max(this.selectRect.y1, this.selectRect.y2);\n    this.selectElement.style.left = x3 + 'px';\n    this.selectElement.style.top = y3 + 'px';\n    this.selectElement.style.width = x4 - x3 + 'px';\n    this.selectElement.style.height = y4 - y3 + 'px';\n  }\n\n  private selectObjects(rectBox: FcRectBox) {\n    this.applyFunction(() => {\n      this.modelService.selectAllInRect(rectBox);\n    });\n  }\n\n}\n\n","import {\n  AfterViewInit,\n  Component,\n  ComponentFactoryResolver, Directive,\n  ElementRef, HostBinding,\n  HostListener,\n  Inject,\n  Input,\n  OnChanges,\n  OnInit,\n  SimpleChanges,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport {\n  FC_NODE_COMPONENT_CONFIG,\n  FcCallbacks,\n  FcConnector,\n  FcNode,\n  FcNodeComponentConfig, FcNodeRectInfo,\n  FlowchartConstants,\n  UserNodeCallbacks\n} from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\n\n@Component({\n  selector: 'fc-node',\n  template: '<ng-template #nodeContent></ng-template>',\n  styleUrls: ['./node.component.scss']\n})\nexport class FcNodeContainerComponent implements OnInit, AfterViewInit, OnChanges {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  userNodeCallbacks: UserNodeCallbacks;\n\n  @Input()\n  node: FcNode;\n\n  @Input()\n  selected: boolean;\n\n  @Input()\n  edit: boolean;\n\n  @Input()\n  underMouse: boolean;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  dragging: boolean;\n\n  @HostBinding('attr.id')\n  get nodeId(): string {\n    return this.node.id;\n  }\n\n  @HostBinding('style.top')\n  get top(): string {\n    return this.node.y + 'px';\n  }\n\n  @HostBinding('style.left')\n  get left(): string {\n    return this.node.x + 'px';\n  }\n\n  nodeComponent: FcNodeComponent;\n\n  @ViewChild('nodeContent', {read: ViewContainerRef, static: true}) nodeContentContainer: ViewContainerRef;\n\n  constructor(@Inject(FC_NODE_COMPONENT_CONFIG) private nodeComponentConfig: FcNodeComponentConfig,\n              private elementRef: ElementRef<HTMLElement>,\n              private componentFactoryResolver: ComponentFactoryResolver) {\n  }\n\n  ngOnInit(): void {\n    if (!this.userNodeCallbacks) {\n      this.userNodeCallbacks = {};\n    }\n    this.userNodeCallbacks.nodeEdit = this.userNodeCallbacks.nodeEdit || (() => {});\n    this.userNodeCallbacks.doubleClick = this.userNodeCallbacks.doubleClick || (() => {});\n    this.userNodeCallbacks.mouseDown = this.userNodeCallbacks.mouseDown || (() => {});\n    this.userNodeCallbacks.mouseEnter = this.userNodeCallbacks.mouseEnter || (() => {});\n    this.userNodeCallbacks.mouseLeave = this.userNodeCallbacks.mouseLeave || (() => {});\n\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.nodeClass);\n    if (!this.node.readonly) {\n      element.attr('draggable', 'true');\n    }\n    this.updateNodeClass();\n    this.modelservice.nodes.setHtmlElement(this.node.id, element[0]);\n    this.nodeContentContainer.clear();\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(this.nodeComponentConfig.nodeComponentType);\n    const componentRef = this.nodeContentContainer.createComponent(componentFactory);\n    this.nodeComponent = componentRef.instance;\n    this.nodeComponent.callbacks = this.callbacks;\n    this.nodeComponent.userNodeCallbacks = this.userNodeCallbacks;\n    this.nodeComponent.node = this.node;\n    this.nodeComponent.modelservice = this.modelservice;\n    this.updateNodeComponent();\n    this.nodeComponent.width = this.elementRef.nativeElement.offsetWidth;\n    this.nodeComponent.height = this.elementRef.nativeElement.offsetHeight;\n  }\n\n  ngAfterViewInit(): void {\n    this.nodeComponent.width = this.elementRef.nativeElement.offsetWidth;\n    this.nodeComponent.height = this.elementRef.nativeElement.offsetHeight;\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    let updateNode = false;\n    for (const propName of Object.keys(changes)) {\n      const change = changes[propName];\n      if (!change.firstChange && change.currentValue !== change.previousValue) {\n        if (['selected', 'edit', 'underMouse', 'mouseOverConnector', 'dragging'].includes(propName)) {\n          updateNode = true;\n        }\n      }\n    }\n    if (updateNode) {\n      this.updateNodeClass();\n      this.updateNodeComponent();\n    }\n  }\n\n  private updateNodeClass() {\n    const element = $(this.elementRef.nativeElement);\n    this.toggleClass(element, FlowchartConstants.selectedClass, this.selected);\n    this.toggleClass(element, FlowchartConstants.editClass, this.edit);\n    this.toggleClass(element, FlowchartConstants.hoverClass, this.underMouse);\n    this.toggleClass(element, FlowchartConstants.draggingClass, this.dragging);\n  }\n\n  private updateNodeComponent() {\n    this.nodeComponent.selected = this.selected;\n    this.nodeComponent.edit = this.edit;\n    this.nodeComponent.underMouse = this.underMouse;\n    this.nodeComponent.mouseOverConnector = this.mouseOverConnector;\n    this.nodeComponent.dragging = this.dragging;\n  }\n\n  private toggleClass(element: JQuery<HTMLElement>, clazz: string, set: boolean) {\n    if (set) {\n      element.addClass(clazz);\n    } else {\n      element.removeClass(clazz);\n    }\n  }\n\n  @HostListener('mousedown', ['$event'])\n  mousedown(event: MouseEvent) {\n    event.stopPropagation();\n  }\n\n  @HostListener('dragstart', ['$event'])\n  dragstart(event: DragEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeDragstart(event, this.node);\n    }\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeDragend(event);\n    }\n  }\n\n  @HostListener('click', ['$event'])\n  click(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeClicked(event, this.node);\n    }\n  }\n\n  @HostListener('mouseover', ['$event'])\n  mouseover(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeMouseOver(event, this.node);\n    }\n  }\n\n  @HostListener('mouseout', ['$event'])\n  mouseout(event: MouseEvent) {\n    if (!this.node.readonly) {\n      this.callbacks.nodeMouseOut(event, this.node);\n    }\n  }\n\n}\n\n@Directive()\nexport abstract class FcNodeComponent implements OnInit {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  userNodeCallbacks: UserNodeCallbacks;\n\n  @Input()\n  node: FcNode;\n\n  @Input()\n  selected: boolean;\n\n  @Input()\n  edit: boolean;\n\n  @Input()\n  underMouse: boolean;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  dragging: boolean;\n\n  flowchartConstants = FlowchartConstants;\n\n  width: number;\n\n  height: number;\n\n  nodeRectInfo: FcNodeRectInfo = {\n    top: () => {\n      return this.node.y;\n    },\n\n    left: () => {\n      return this.node.x;\n    },\n\n    bottom: () => {\n      return this.node.y + this.height;\n    },\n\n    right: () => {\n      return this.node.x + this.width;\n    },\n\n    width: () => {\n      return this.width;\n    },\n\n    height: () => {\n      return this.height;\n    }\n  };\n\n  ngOnInit(): void {\n  }\n\n}\n","<div (click)=\"canvasClick($event)\" class=\"fc-canvas-container\">\n  <svg class=\"fc-canvas-svg\">\n    <defs>\n      <marker class=\"fc-arrow-marker\" [attr.id]=\"arrowDefId\" markerWidth=\"5\" markerHeight=\"5\" viewBox=\"-6 -6 12 12\" refX=\"10\" refY=\"0\" markerUnits=\"strokeWidth\" orient=\"auto\">\n        <polygon points=\"-2,0 -5,5 5,0 -5,-5\" stroke=\"gray\" fill=\"gray\" stroke-width=\"1px\"/>\n      </marker>\n      <marker class=\"fc-arrow-marker-selected\" [attr.id]=\"arrowDefIdSelected\" markerWidth=\"5\" markerHeight=\"5\" viewBox=\"-6 -6 12 12\" refX=\"10\" refY=\"0\" markerUnits=\"strokeWidth\" orient=\"auto\">\n        <polygon points=\"-2,0 -5,5 5,0 -5,-5\" stroke=\"red\" fill=\"red\" stroke-width=\"1px\"/>\n      </marker>\n    </defs>\n    <g *ngFor=\"let edge of model.edges; let $index = index\">\n      <path\n        [attr.id]=\"'fc-edge-path-'+$index\"\n        (mousedown)=\"edgeMouseDown($event, edge)\"\n        (click)=\"edgeClick($event, edge)\"\n        (dblclick)=\"edgeDoubleClick($event, edge)\"\n        (mouseover)=\"edgeMouseOver($event, edge)\"\n        (mouseenter)=\"edgeMouseEnter($event, edge)\"\n        (mouseleave)=\"edgeMouseLeave($event, edge)\"\n        [attr.class]=\"(modelService.edges.isSelected(edge) && flowchartConstants.selectedClass + ' ' + flowchartConstants.edgeClass) ||\n                      edge === mouseoverService.mouseoverscope.edge && flowchartConstants.hoverClass + ' ' + flowchartConstants.edgeClass ||\n                      edge.active && flowchartConstants.activeClass + ' ' + flowchartConstants.edgeClass ||\n                      flowchartConstants.edgeClass\"\n        [attr.d]=\"getEdgeDAttribute(edge)\"\n        [attr.marker-end]=\"'url(#' + (modelService.edges.isSelected(edge) ? arrowDefIdSelected : arrowDefId) + ')'\">\n      </path>\n    </g>\n    <g *ngIf=\"dragAnimation === flowchartConstants.dragAnimationRepaint && edgeDraggingService.edgeDragging.isDragging\">\n      <path [attr.class]=\"flowchartConstants.edgeClass + ' ' + flowchartConstants.draggingClass\"\n            [attr.d]=\"edgeDrawingService.getEdgeDAttribute(edgeDraggingService.edgeDragging.dragPoint1, edgeDraggingService.edgeDragging.dragPoint2, edgeStyle)\"></path>\n      <circle class=\"edge-endpoint\" r=\"4\"\n              [attr.cx]=\"edgeDraggingService.edgeDragging.dragPoint2.x\"\n              [attr.cy]=\"edgeDraggingService.edgeDragging.dragPoint2.y\">\n      </circle>\n    </g>\n    <g *ngIf=\"dragAnimation === flowchartConstants.dragAnimationShadow\"\n       class=\"shadow-svg-class {{ flowchartConstants.edgeClass }} {{ flowchartConstants.draggingClass }}\"\n       style=\"display:none\">\n      <path d=\"\"></path>\n      <circle class=\"edge-endpoint\" r=\"4\"></circle>\n    </g>\n  </svg>\n  <ng-container *ngFor=\"let node of model.nodes\">\n    <fc-node\n         [selected]=\"modelService.nodes.isSelected(node)\"\n         [edit]=\"modelService.nodes.isEdit(node)\"\n         [underMouse]=\"node === mouseoverService.mouseoverscope.node\"\n         [node]=\"node\"\n         [mouseOverConnector]=\"mouseoverService.mouseoverscope.connector\"\n         [modelservice]=\"modelService\"\n         [dragging]=\"nodeDraggingService.isDraggingNode(node)\"\n         [callbacks]=\"callbacks\"\n         [userNodeCallbacks]=\"userNodeCallbacks\">\n    </fc-node>\n  </ng-container>\n  <div *ngIf=\"dragAnimation === flowchartConstants.dragAnimationRepaint && edgeDraggingService.edgeDragging.isDragging\"\n       [attr.class]=\"'fc-noselect ' + flowchartConstants.edgeLabelClass\"\n       [ngStyle]=\"{\n          top: (edgeDrawingService.getEdgeCenter(edgeDraggingService.edgeDragging.dragPoint1, edgeDraggingService.edgeDragging.dragPoint2).y)+'px',\n          left: (edgeDrawingService.getEdgeCenter(edgeDraggingService.edgeDragging.dragPoint1, edgeDraggingService.edgeDragging.dragPoint2).x)+'px'\n       }\">\n    <div class=\"fc-edge-label-text\">\n      <span [attr.id]=\"'fc-edge-label-dragging'\" *ngIf=\"edgeDraggingService.edgeDragging.dragLabel\">{{edgeDraggingService.edgeDragging.dragLabel}}</span>\n    </div>\n  </div>\n  <div\n    (mousedown)=\"edgeMouseDown($event, edge)\"\n    (click)=\"edgeClick($event, edge)\"\n    (dblclick)=\"edgeDoubleClick($event, edge)\"\n    (mouseover)=\"edgeMouseOver($event, edge)\"\n    (mouseenter)=\"edgeMouseEnter($event, edge)\"\n    (mouseleave)=\"edgeMouseLeave($event, edge)\"\n    [attr.class]=\"'fc-noselect ' + ((modelService.edges.isEdit(edge) && flowchartConstants.editClass + ' ' + flowchartConstants.edgeLabelClass) ||\n                      (modelService.edges.isSelected(edge) && flowchartConstants.selectedClass + ' ' + flowchartConstants.edgeLabelClass) ||\n                      edge === mouseoverService.mouseoverscope.edge && flowchartConstants.hoverClass + ' ' + flowchartConstants.edgeLabelClass ||\n                      edge.active && flowchartConstants.activeClass + ' ' + flowchartConstants.edgeLabelClass ||\n                      flowchartConstants.edgeLabelClass)\"\n    [ngStyle]=\"{\n      top: (edgeDrawingService.getEdgeCenter(modelService.edges.sourceCoord(edge), modelService.edges.destCoord(edge)).y)+'px',\n      left: (edgeDrawingService.getEdgeCenter(modelService.edges.sourceCoord(edge), modelService.edges.destCoord(edge)).x)+'px'\n    }\"\n    *ngFor=\"let edge of model.edges; let $index = index\">\n    <div class=\"fc-edge-label-text\">\n      <div *ngIf=\"modelService.isEditable()\" class=\"fc-noselect fc-nodeedit\" (click)=\"edgeEdit($event, edge)\">\n        <i class=\"fa fa-pencil\" aria-hidden=\"true\"></i>\n      </div>\n      <div *ngIf=\"modelService.isEditable()\" class=\"fc-noselect fc-nodedelete\" (click)=\"edgeRemove($event, edge)\">\n        &times;\n      </div>\n      <span [attr.id]=\"'fc-edge-label-'+$index\" *ngIf=\"edge.label\">{{edge.label}}</span>\n    </div>\n  </div>\n  <div id=\"select-rectangle\" class=\"fc-select-rectangle\" hidden>\n  </div>\n</div>\n","import {\n  ChangeDetectionStrategy, ChangeDetectorRef,\n  Component,\n  DoCheck,\n  ElementRef, EventEmitter,\n  HostBinding,\n  HostListener,\n  Input,\n  IterableDiffer,\n  IterableDiffers,\n  NgZone,\n  OnInit, Output\n} from '@angular/core';\nimport { FcCallbacks, FcEdge, FcModel, FcNode, FlowchartConstants, UserCallbacks, UserNodeCallbacks } from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\nimport { FcModelValidationService } from './modelvalidation.service';\nimport { FcNodeDraggingService } from './node-dragging.service';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { FcEdgeDraggingService } from './edge-dragging.service';\nimport { FcMouseOverService } from './mouseover.service';\nimport { FcRectangleSelectService } from './rectangleselect.service';\nimport { coerceBooleanProperty } from '@angular/cdk/coercion';\nimport { Subject } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\n@Component({\n  selector: 'fc-canvas',\n  templateUrl: './ngx-flowchart.component.html',\n  styleUrls: ['./ngx-flowchart.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class NgxFlowchartComponent implements OnInit, DoCheck {\n\n  @HostBinding('attr.class')\n  get canvasClass(): string {\n    return FlowchartConstants.canvasClass;\n  }\n\n  @Input()\n  model: FcModel;\n\n  @Input()\n  selectedObjects: any[];\n\n  @Input()\n  edgeStyle: string;\n\n  @Input()\n  userCallbacks: UserCallbacks;\n\n  @Input()\n  automaticResize: boolean;\n\n  @Input()\n  dragAnimation: string;\n\n  @Input()\n  nodeWidth: number;\n\n  @Input()\n  nodeHeight: number;\n\n  @Input()\n  dropTargetId: string;\n\n  @Output()\n  modelChanged = new EventEmitter();\n\n  private fitModelSizeByDefaultValue = true;\n  get fitModelSizeByDefault(): boolean {\n    return this.fitModelSizeByDefaultValue;\n  }\n  @Input()\n  set fitModelSizeByDefault(value: boolean) {\n    this.fitModelSizeByDefaultValue = coerceBooleanProperty(value);\n  }\n\n  callbacks: FcCallbacks;\n\n  userNodeCallbacks: UserNodeCallbacks;\n\n  modelService: FcModelService;\n  nodeDraggingService: FcNodeDraggingService;\n  edgeDraggingService: FcEdgeDraggingService;\n  mouseoverService: FcMouseOverService;\n  rectangleSelectService: FcRectangleSelectService;\n\n  arrowDefId: string;\n  arrowDefIdSelected: string;\n\n  flowchartConstants = FlowchartConstants;\n\n  private nodesDiffer: IterableDiffer<FcNode> = this.differs.find([]).create<FcNode>((index, item) => {\n    return item;\n  });\n\n  private edgesDiffer: IterableDiffer<FcEdge> = this.differs.find([]).create<FcEdge>((index, item) => {\n    return item;\n  });\n\n  private readonly detectChangesSubject = new Subject<any>();\n\n  constructor(private elementRef: ElementRef<HTMLElement>,\n              private differs: IterableDiffers,\n              private modelValidation: FcModelValidationService,\n              public edgeDrawingService: FcEdgeDrawingService,\n              private cd: ChangeDetectorRef,\n              private zone: NgZone) {\n    this.arrowDefId = 'arrow-' + Math.random();\n    this.arrowDefIdSelected = this.arrowDefId + '-selected';\n    this.detectChangesSubject\n      .pipe(debounceTime(50))\n      .subscribe(() => this.cd.detectChanges());\n  }\n\n  ngOnInit() {\n    if (!this.dropTargetId && this.edgeStyle !== FlowchartConstants.curvedStyle && this.edgeStyle !== FlowchartConstants.lineStyle) {\n      throw new Error('edgeStyle not supported.');\n    }\n    this.nodeHeight = this.nodeHeight || 200;\n    this.nodeWidth = this.nodeWidth || 200;\n    this.dragAnimation = this.dragAnimation || FlowchartConstants.dragAnimationRepaint;\n    this.userCallbacks = this.userCallbacks || {};\n    this.automaticResize = this.automaticResize || false;\n\n    for (const key of Object.keys(this.userCallbacks)) {\n      const callback = this.userCallbacks[key];\n      if (typeof callback !== 'function' && key !== 'nodeCallbacks') {\n        throw new Error('All callbacks should be functions.');\n      }\n    }\n\n    this.userNodeCallbacks = this.userCallbacks.nodeCallbacks;\n\n    const element = $(this.elementRef.nativeElement);\n\n    this.modelService = new FcModelService(this.modelValidation, this.model, this.modelChanged,\n      this.detectChangesSubject, this.selectedObjects,\n      this.userCallbacks.dropNode, this.userCallbacks.createEdge, this.userCallbacks.edgeAdded, this.userCallbacks.nodeRemoved,\n      this.userCallbacks.edgeRemoved, element[0], element[0].querySelector('svg'));\n\n    if (this.dropTargetId) {\n      this.modelService.dropTargetId = this.dropTargetId;\n    }\n\n    const applyFunction = this.zone.run.bind(this.zone);\n\n    this.nodeDraggingService = new FcNodeDraggingService(this.modelService, applyFunction,\n          this.automaticResize, this.dragAnimation);\n\n    this.edgeDraggingService = new FcEdgeDraggingService(this.modelValidation, this.edgeDrawingService, this.modelService,\n      this.model, this.userCallbacks.isValidEdge || null, applyFunction,\n      this.dragAnimation, this.edgeStyle);\n\n    this.mouseoverService = new FcMouseOverService(applyFunction);\n\n    this.rectangleSelectService = new FcRectangleSelectService(this.modelService,\n      element[0].querySelector('#select-rectangle'), applyFunction);\n\n    this.callbacks = {\n      nodeDragstart: this.nodeDraggingService.dragstart.bind(this.nodeDraggingService),\n      nodeDragend: this.nodeDraggingService.dragend.bind(this.nodeDraggingService),\n      edgeDragstart: this.edgeDraggingService.dragstart.bind(this.edgeDraggingService),\n      edgeDragend: this.edgeDraggingService.dragend.bind(this.edgeDraggingService),\n      edgeDrop: this.edgeDraggingService.drop.bind(this.edgeDraggingService),\n      edgeDragoverConnector: this.edgeDraggingService.dragoverConnector.bind(this.edgeDraggingService),\n      edgeDragoverMagnet: this.edgeDraggingService.dragoverMagnet.bind(this.edgeDraggingService),\n      edgeDragleaveMagnet: this.edgeDraggingService.dragleaveMagnet.bind(this.edgeDraggingService),\n      nodeMouseOver: this.mouseoverService.nodeMouseOver.bind(this.mouseoverService),\n      nodeMouseOut: this.mouseoverService.nodeMouseOut.bind(this.mouseoverService),\n      connectorMouseEnter: this.mouseoverService.connectorMouseEnter.bind(this.mouseoverService),\n      connectorMouseLeave: this.mouseoverService.connectorMouseLeave.bind(this.mouseoverService),\n      nodeClicked: (event, node) => {\n        this.modelService.nodes.handleClicked(node, event.ctrlKey);\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    };\n    this.adjustCanvasSize(this.fitModelSizeByDefault);\n  }\n\n  ngDoCheck(): void {\n    if (this.model) {\n      const nodesChange = this.nodesDiffer.diff(this.model.nodes);\n      const edgesChange = this.edgesDiffer.diff(this.model.edges);\n      let nodesChanged = false;\n      let edgesChanged = false;\n      if (nodesChange !== null) {\n        nodesChange.forEachAddedItem(() => {\n          nodesChanged = true;\n        });\n        nodesChange.forEachRemovedItem(() => {\n          nodesChanged = true;\n        });\n      }\n      if (edgesChange !== null) {\n        edgesChange.forEachAddedItem(() => {\n          edgesChanged = true;\n        });\n        edgesChange.forEachRemovedItem(() => {\n          edgesChanged = true;\n        });\n      }\n      if (nodesChanged) {\n        this.adjustCanvasSize(this.fitModelSizeByDefault);\n      }\n      if (nodesChanged || edgesChanged) {\n        this.detectChangesSubject.next();\n      }\n    }\n  }\n\n  getEdgeDAttribute(edge: FcEdge): string {\n    return this.edgeDrawingService.getEdgeDAttribute(this.modelService.edges.sourceCoord(edge),\n      this.modelService.edges.destCoord(edge), this.edgeStyle);\n  }\n\n  public adjustCanvasSize(fit?: boolean) {\n    let maxX = 0;\n    let maxY = 0;\n    const element = $(this.elementRef.nativeElement);\n    this.model.nodes.forEach((node) => {\n      maxX = Math.max(node.x + this.nodeWidth, maxX);\n      maxY = Math.max(node.y + this.nodeHeight, maxY);\n    });\n    let width;\n    let height;\n    if (fit) {\n      width = maxX;\n      height = maxY;\n    } else {\n      width = Math.max(maxX, element.prop('offsetWidth'));\n      height = Math.max(maxY, element.prop('offsetHeight'));\n    }\n    element.css('width', width + 'px');\n    element.css('height', height + 'px');\n  }\n\n  canvasClick(event: MouseEvent) {}\n\n  edgeMouseDown(event: MouseEvent, edge: FcEdge) {\n    event.stopPropagation();\n  }\n\n  edgeClick(event: MouseEvent, edge: FcEdge) {\n    this.modelService.edges.handleEdgeMouseClick(edge, event.ctrlKey);\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  edgeRemove(event: Event, edge: FcEdge) {\n    this.modelService.edges.delete(edge);\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  edgeEdit(event: Event, edge: FcEdge) {\n    if (this.userCallbacks.edgeEdit) {\n      this.userCallbacks.edgeEdit(event, edge);\n    }\n  }\n\n  edgeDoubleClick(event: MouseEvent, edge: FcEdge) {\n    if (this.userCallbacks.edgeDoubleClick) {\n      this.userCallbacks.edgeDoubleClick(event, edge);\n    }\n  }\n\n  edgeMouseOver(event: MouseEvent, edge: FcEdge) {\n    if (this.userCallbacks.edgeMouseOver) {\n      this.userCallbacks.edgeMouseOver(event, edge);\n    }\n  }\n\n  edgeMouseEnter(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverService.edgeMouseEnter(event, edge);\n  }\n\n  edgeMouseLeave(event: MouseEvent, edge: FcEdge) {\n    this.mouseoverService.edgeMouseLeave(event, edge);\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    this.nodeDraggingService.dragover(event);\n    this.edgeDraggingService.dragover(event);\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    if (event.preventDefault) {\n      event.preventDefault();\n    }\n    if (event.stopPropagation) {\n      event.stopPropagation();\n    }\n    this.nodeDraggingService.drop(event);\n  }\n\n  @HostListener('mousedown', ['$event'])\n  mousedown(event: MouseEvent) {\n    this.rectangleSelectService.mousedown(event);\n  }\n\n  @HostListener('mousemove', ['$event'])\n  mousemove(event: MouseEvent) {\n    this.rectangleSelectService.mousemove(event);\n  }\n\n  @HostListener('mouseup', ['$event'])\n  mouseup(event: MouseEvent) {\n    this.rectangleSelectService.mouseup(event);\n  }\n\n}\n","import { Directive, ElementRef, HostListener, Input, OnInit } from '@angular/core';\nimport { FcCallbacks, FcConnector, FlowchartConstants } from './ngx-flowchart.models';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[fc-magnet]'\n})\nexport class FcMagnetDirective implements OnInit {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  connector: FcConnector;\n\n  constructor(public elementRef: ElementRef<HTMLElement>) {\n  }\n\n  ngOnInit(): void {\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.magnetClass);\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    return this.callbacks.edgeDragoverMagnet(event, this.connector);\n  }\n\n  @HostListener('dragleave', ['$event'])\n  dragleave(event: DragEvent) {\n    this.callbacks.edgeDragleaveMagnet(event);\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    return this.callbacks.edgeDrop(event, this.connector);\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    this.callbacks.edgeDragend(event);\n  }\n\n}\n","import { AfterViewInit, Directive, ElementRef, HostListener, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { FcCallbacks, FcConnector, FcConnectorRectInfo, FcNodeRectInfo, FlowchartConstants } from './ngx-flowchart.models';\nimport { FcModelService } from './model.service';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[fc-connector]'\n})\nexport class FcConnectorDirective implements OnInit, OnChanges {\n\n  @Input()\n  callbacks: FcCallbacks;\n\n  @Input()\n  modelservice: FcModelService;\n\n  @Input()\n  connector: FcConnector;\n\n  @Input()\n  nodeRectInfo: FcNodeRectInfo;\n\n  @Input()\n  mouseOverConnector: FcConnector;\n\n  constructor(public elementRef: ElementRef<HTMLElement>) {\n  }\n\n  ngOnInit(): void {\n    const element = $(this.elementRef.nativeElement);\n    element.addClass(FlowchartConstants.connectorClass);\n    if (this.modelservice.isEditable()) {\n      element.attr('draggable', 'true');\n      this.updateConnectorClass();\n    }\n    const connectorRectInfo: FcConnectorRectInfo = {\n      type: this.connector.type,\n      width: this.elementRef.nativeElement.offsetWidth,\n      height: this.elementRef.nativeElement.offsetHeight,\n      nodeRectInfo: this.nodeRectInfo\n    };\n    this.modelservice.connectors.setConnectorRectInfo(this.connector.id, connectorRectInfo);\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    let updateConnector = false;\n    for (const propName of Object.keys(changes)) {\n      const change = changes[propName];\n      if (!change.firstChange && change.currentValue !== change.previousValue) {\n        if (propName === 'mouseOverConnector') {\n          updateConnector = true;\n        }\n      }\n    }\n    if (updateConnector && this.modelservice.isEditable()) {\n      this.updateConnectorClass();\n    }\n  }\n\n  private updateConnectorClass() {\n    const element = $(this.elementRef.nativeElement);\n    if (this.connector === this.mouseOverConnector) {\n      element.addClass(FlowchartConstants.hoverClass);\n    } else {\n      element.removeClass(FlowchartConstants.hoverClass);\n    }\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragover(event: DragEvent) {\n    // Skip - conflict with magnet\n    /* if (this.modelservice.isEditable()) {\n      return this.callbacks.edgeDragoverConnector(event, this.connector);\n    }*/\n  }\n\n  @HostListener('drop', ['$event'])\n  drop(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      return this.callbacks.edgeDrop(event, this.connector);\n    }\n  }\n\n  @HostListener('dragend', ['$event'])\n  dragend(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.edgeDragend(event);\n    }\n  }\n\n  @HostListener('dragstart', ['$event'])\n  dragstart(event: DragEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.edgeDragstart(event, this.connector);\n    }\n  }\n\n  @HostListener('mouseenter', ['$event'])\n  mouseenter(event: MouseEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.connectorMouseEnter(event, this.connector);\n    }\n  }\n\n  @HostListener('mouseleave', ['$event'])\n  mouseleave(event: MouseEvent) {\n    if (this.modelservice.isEditable()) {\n      this.callbacks.connectorMouseLeave(event, this.connector);\n    }\n  }\n\n}\n","<div\n  (dblclick)=\"userNodeCallbacks.doubleClick($event, node)\">\n  <div class=\"{{flowchartConstants.nodeOverlayClass}}\"></div>\n  <div class=\"innerNode\">\n    <p>{{ node.name }}</p>\n\n    <div class=\"{{flowchartConstants.leftConnectorClass}}\">\n      <div fc-magnet [connector]=\"connector\" [callbacks]=\"callbacks\"\n           *ngFor=\"let connector of modelservice.nodes.getConnectorsByType(node, flowchartConstants.leftConnectorType)\">\n        <div fc-connector [connector]=\"connector\"\n             [nodeRectInfo]=\"nodeRectInfo\"\n             [mouseOverConnector]=\"mouseOverConnector\"\n             [callbacks]=\"callbacks\"\n             [modelservice]=\"modelservice\"></div>\n      </div>\n    </div>\n    <div class=\"{{flowchartConstants.rightConnectorClass}}\">\n      <div fc-magnet [connector]=\"connector\" [callbacks]=\"callbacks\"\n           *ngFor=\"let connector of modelservice.nodes.getConnectorsByType(node, flowchartConstants.rightConnectorType)\">\n        <div fc-connector [connector]=\"connector\"\n             [nodeRectInfo]=\"nodeRectInfo\"\n             [mouseOverConnector]=\"mouseOverConnector\"\n             [callbacks]=\"callbacks\"\n             [modelservice]=\"modelservice\"></div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"modelservice.isEditable() && !node.readonly\" class=\"fc-nodeedit\" (click)=\"userNodeCallbacks.nodeEdit($event, node)\">\n    <i class=\"fa fa-pencil\" aria-hidden=\"true\"></i>\n  </div>\n  <div *ngIf=\"modelservice.isEditable() && !node.readonly\" class=\"fc-nodedelete\" (click)=\"modelservice.nodes.delete(node)\">\n    &times;\n  </div>\n</div>\n","import { Component } from '@angular/core';\nimport { FcNodeComponent } from './node.component';\n\n@Component({\n  selector: 'fc-default-node',\n  templateUrl: './default-node.component.html',\n  styleUrls: ['./default-node.component.scss']\n})\nexport class DefaultFcNodeComponent extends FcNodeComponent {\n\n  constructor() {\n    super();\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { NgxFlowchartComponent } from './ngx-flowchart.component';\nimport { FcModelValidationService } from './modelvalidation.service';\nimport { FcEdgeDrawingService } from './edge-drawing.service';\nimport { CommonModule } from '@angular/common';\nimport { FcMagnetDirective } from './magnet.directive';\nimport { FcConnectorDirective } from './connector.directive';\nimport { FcNodeContainerComponent } from './node.component';\nimport { FC_NODE_COMPONENT_CONFIG } from './ngx-flowchart.models';\nimport { DefaultFcNodeComponent } from './default-node.component';\n\n@NgModule({\n  entryComponents: [\n    DefaultFcNodeComponent\n  ],\n  declarations: [NgxFlowchartComponent,\n    FcMagnetDirective,\n    FcConnectorDirective,\n    FcNodeContainerComponent,\n    DefaultFcNodeComponent],\n  providers: [\n    FcModelValidationService,\n    FcEdgeDrawingService,\n    {\n      provide: FC_NODE_COMPONENT_CONFIG,\n      useValue: {\n        nodeComponentType: DefaultFcNodeComponent\n      }\n    }\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [NgxFlowchartComponent,\n    FcMagnetDirective,\n    FcConnectorDirective,\n    DefaultFcNodeComponent]\n})\nexport class NgxFlowchartModule { }\n"]}